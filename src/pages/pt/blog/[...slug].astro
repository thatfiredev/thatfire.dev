---
import { type CollectionEntry, getCollection } from "astro:content";
import BlogPost from "../../../layouts/BlogPost.astro";

export async function getStaticPaths() {
	const posts = await getCollection("blog", ({ id }) => id.startsWith("pt/"));
	return posts.map((post) => {
		const [lang, ...slugParts] = post.id.split("/");
		return {
			params: { slug: slugParts.join("/").replace(/\.(md|mdx)$/, "") },
			props: post,
		};
	});
}
type Props = CollectionEntry<"blog">;

const post = Astro.props;

// Find translations
const allPosts = await getCollection("blog");
const translations = allPosts
	.filter((p) => p.data.translationKey === post.data.translationKey)
	.reduce((acc, p) => {
		const [lang, ...slugParts] = p.id.split("/");
		acc[lang] =
			`/${lang === "en" ? "" : lang + "/"}blog/${slugParts.join("/").replace(/\.(md|mdx)$/, "")}/`;
		return acc;
	}, {});

const { Content } = await post.render();
---

<BlogPost {...post.data} translations={translations}>
	<Content />
</BlogPost>
