<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Como funcionam as regras de seguran√ßa do Cloud Storage for Firebase?</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Como funcionam as regras de seguran√ßa do Cloud Storage for Firebase?</h1>
</header>
<section data-field="subtitle" class="p-summary">
Saiba como garantir a seguran√ßa dos ficheiros no Firebase Storage
</section>
<section data-field="body" class="e-content">
<section name="a6da" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><figure name="86f2" id="86f2" class="graf graf--figure graf--leading"><img class="graf-image" data-image-id="1*j3emxEb3BNVYd10L2iDx0Q.png" data-width="1043" data-height="313" src="https://cdn-images-1.medium.com/max/800/1*j3emxEb3BNVYd10L2iDx0Q.png"><figcaption class="imageCaption">Cloud Storage for Firebase Logo from firebase.google.com/products</figcaption></figure><h3 name="842a" id="842a" class="graf graf--h3 graf-after--figure graf--title">Como funcionam as regras de seguran√ßa do Cloud Storage for Firebase?</h3><h4 name="5d32" id="5d32" class="graf graf--h4 graf-after--h3 graf--subtitle">Saiba como garantir a seguran√ßa dos ficheiros no Firebase¬†Storage</h4><p name="4ace" id="4ace" class="graf graf--p graf-after--h4">Ao desenvolver uma aplica√ß√£o capaz de armazenar ficheiros para disponibiliz√°-los √† outros utilizadores, voc√™ provavelmente encontrou o <a href="https://firebase.google.com/products/storage/" data-href="https://firebase.google.com/products/storage/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Cloud Storage for Firebase</a> (tamb√©m chamado Firebase Storage) como uma das tecnologias que permitem fazer isso de forma simples, f√°cil e r√°pida. E se voc√™ escolheu o Firebase Storage dentre as outras op√ß√µes, devo parabeniz√°-lo pela escolha. Mas al√©m de armazenarmos os dados de forma simples, precisamos garantir que eles estejam seguros. E para fazer isso no Firebase Storage, utilizamos as regras de seguran√ßa‚Ää‚Äî‚Ääo assunto principal deste artigo.</p><h3 name="b98a" id="b98a" class="graf graf--h3 graf-after--p">Conhecendo as Security¬†Rules</h3><p name="19d3" id="19d3" class="graf graf--p graf-after--h3">Quem j√° viu/utilizou as Regras da Realtime Database, ao aceder √† aba de <a href="https://console.firebase.google.com/u/0/project/_/storage/rules" data-href="https://console.firebase.google.com/u/0/project/_/storage/rules" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Regras do Storage</a> na Consola do Firebase notar√° que a estrutura das regras de seguran√ßa s√£o diferentes. Isso porque as regras da Realtime Database ficam organizadas em uma √°rvore JSON, enquanto que as do Cloud Storage parecem um JSON sem aspas:</p><pre name="497b" id="497b" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">service firebase.storage {<br>  match /b/{bucket}/o {<br>    match /{allPaths=**} {<br>      allow read, write: if request.auth != null;<br>    }<br>  }<br>}</code></pre><p name="e715" id="e715" class="graf graf--p graf-after--pre">Esta organiza√ß√£o √© utilizada em alguns dos servi√ßos da <a href="https://cloud.google.com/" data-href="https://cloud.google.com/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Google Cloud Platform</a> como o <a href="https://firebase.google.com/products/firestore/" data-href="https://firebase.google.com/products/firestore/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Cloud Firestore</a> (provavelmente falarei dele num dos pr√≥ximos artigos).</p><p name="25bb" id="25bb" class="graf graf--p graf-after--p">Tal como na <a href="https://firebase.google.com/products/realtime-database/" data-href="https://firebase.google.com/products/realtime-database/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Realtime Database</a>, as regras de seguran√ßa do Cloud Storage permitem controlar opera√ß√µes de leitura e/ou escrita em ficheiros. Podemos tamb√©m controlar como estes ficheiros s√£o estruturados e quais meta-dados eles possuem.</p><p name="5a08" id="5a08" class="graf graf--p graf-after--p">Para utilizarmos as regras de seguran√ßa do Cloud Storage, precisamos de conhecer 2 palavras reservadas: <code class="markup--code markup--p-code">allow</code> e <code class="markup--code markup--p-code">match</code>.</p><h3 name="a8e8" id="a8e8" class="graf graf--h3 graf-after--p">allow</h3><p name="984c" id="984c" class="graf graf--p graf-after--h3">Tal como indica o nome, <code class="markup--code markup--p-code">allow</code> indica se uma opera√ß√£o (<code class="markup--code markup--p-code">read</code> ou <code class="markup--code markup--p-code">write</code>) √© permitida ou n√£o, de acordo com uma condi√ß√£o especificada (opcional). Por exemplo:</p><pre name="48da" id="48da" class="graf graf--pre graf-after--p"><em class="markup--em markup--pre-em">// Se n√£o for especificada uma condi√ß√£o, a regra torna-se true</em><br><strong class="markup--strong markup--pre-strong">allow read;</strong></pre><pre name="1729" id="1729" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Utilize a palavra if para especificar uma condi√ß√£o:</em><br><strong class="markup--strong markup--pre-strong">allow read: if &lt;condi√ß√£o&gt;;</strong></pre><pre name="0f42" id="0f42" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Voc√™ pode tamb√©m utilizar uma √∫nica condi√ß√£o para leitura e escrita</em><br><strong class="markup--strong markup--pre-strong">allow read, write: if &lt;condi√ß√£o&gt;;</strong></pre><h4 name="c2c7" id="c2c7" class="graf graf--h4 graf-after--pre">Regras simples</h4><p name="b5aa" id="b5aa" class="graf graf--p graf-after--h4">Lembra quando n√≥s coloc√°vamos ambas regras (<code class="markup--code markup--p-code">.write</code> e¬†<code class="markup--code markup--p-code">.read</code>) da Realtime Database em <code class="markup--code markup--p-code">true</code> para testarmos, deixando a base de dados totalmente insegura? Pois √©, o equivalente no Cloud Storage √©:</p><pre name="58bb" id="58bb" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">service firebase.storage {<br>  match /b/{bucket}/o {<br>    match /{allPaths=**} {<br>      allow read, write;<br>    }<br>  }<br>}</code> </pre><p name="cfe8" id="cfe8" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">Nota</strong>: Isto ir√° deixar o Storage p√∫blico, o que significa que qualquer pessoa (mesmo que n√£o seja utilizador da sua aplica√ß√£o) pode armazenar e obter ficheiros do seu Cloud Storage. Utilize estas regras apenas para testes.</p><p name="220c" id="220c" class="graf graf--p graf-after--p">Se quis√©ssemos fazer o inverso do exemplo acima, na Realtime Database colocar√≠amos o¬†<code class="markup--code markup--p-code">.write</code> e¬†<code class="markup--code markup--p-code">.read</code> em <code class="markup--code markup--p-code">false</code>. Assim, ningu√©m (al√©m dos administradores do projeto) teria acesso √† base de dados. No Cloud Storage isto pode ser obtido com as seguintes regras:</p><pre name="795b" id="795b" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">service firebase.storage {<br>  match /b/{bucket}/o {<br>    match /{allPaths=**} {<br>      allow read, write: if false;<br>    }<br>  }<br>}</code></pre><p name="13fa" id="13fa" class="graf graf--p graf-after--pre">E quando utilizav√°mos o <code class="markup--code markup--p-code">auth!=null</code> na Realtime Database? Permit√≠amos que a base de dados fosse acedida apenas por utilizadores registados no Firebase Auth. No Cloud Storage tamb√©m √© poss√≠vel:</p><pre name="dbd4" id="dbd4" class="graf graf--pre graf-after--p">service firebase.storage {<br>  match /b/{bucket}/o {<br>    match /{allPaths=**} {<br>      allow read, write: if request.auth != null;<br>    }<br>  }<br>}</pre><h3 name="80e7" id="80e7" class="graf graf--h3 graf-after--pre">match</h3><p name="0f96" id="0f96" class="graf graf--p graf-after--h3">Como voc√™ j√° deve ter reparado, em todas as regras que escrevemos at√© agora, utilizamos a palavra match. Ela serve para especificarmos o caminho onde queremos aplicar cada regra. Este caminho pode ser especificado ao detalhe (caminho exato e est√°tico) ou atrav√©s de vari√°veis (caminho din√¢mico).</p><h4 name="e974" id="e974" class="graf graf--h4 graf-after--p">Caminho Exato</h4><p name="1284" id="1284" class="graf graf--p graf-after--h4">Este √© o match mais simples, utilizado quando j√° sabemos o caminho exato do ficheiro √† que queremos aplicar as regras. Por exemplo, para aplicar regras aos ficheiros <em class="markup--em markup--p-em">fotoPerfil.png</em> e <em class="markup--em markup--p-em">miniatura.png</em> localizados no diret√≥rio <em class="markup--em markup--p-em">/imagens</em>¬†:</p><pre name="d91f" id="d91f" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">match /imagens/fotoPerfil.png</strong> {<br>  allow write: if &lt;condi√ß√£o&gt;;<br>}<br><strong class="markup--strong markup--pre-strong">match /imagens/miniatura.png</strong> {<br>  allow write: if &lt;condi√ß√£o&gt;;<br>}</pre><p name="1f79" id="1f79" class="graf graf--p graf-after--pre">Outra forma seria dividir o caminho, criando ramifica√ß√µes na √°rvore:</p><pre name="e475" id="e475" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">match /imagens</strong> {<br>    <strong class="markup--strong markup--pre-strong">match /fotoPerfil.png</strong> {<br>        allow write: if &lt;condi√ß√£o&gt;;<br>    }<br>    <strong class="markup--strong markup--pre-strong">match /miniatura.png</strong> {<br>        allow write: if &lt;condi√ß√£o&gt;;<br>    }<br>}</pre><h4 name="ca66" id="ca66" class="graf graf--h4 graf-after--pre">Caminho din√¢mico (uso de vari√°veis)</h4><p name="0076" id="0076" class="graf graf--p graf-after--h4">Por vezes, podemos n√£o conhecer o nome de um ficheiro ou de um diret√≥rio. Nesses casos, utilizamos vari√°veis tal como faz√≠amos na Realtime Database (utilizando o cifr√£o <code class="markup--code markup--p-code">$</code>), mas aqui colocamos o nome da vari√°vel entre chavetas. Por exemplo:</p><pre name="e034" id="e034" class="graf graf--pre graf-after--p">match /imagens {<br>    //Todas imagens no direct√≥rio imagens.<br>    <strong class="markup--strong markup--pre-strong">match /{nomeImagem}</strong> {<br>      allow read: if &lt;condi√ß√£o&gt;;<br>    }<br>  <br>    //Todas imagens no direct√≥rio imagens, inclu√≠ndo subdirect√≥rios<br>    <strong class="markup--strong markup--pre-strong">match /{todasImagens=**}</strong> {<br>      allow read: if &lt;outra_condi√ß√£o&gt;;<br>    }<br>}</pre><h3 name="0e1a" id="0e1a" class="graf graf--h3 graf-after--pre">Utilizando as regras para valida√ß√£o</h3><p name="dc45" id="dc45" class="graf graf--p graf-after--h3">Para al√©m de controlar permiss√µes para armazenamento e leitura de ficheiros, podemos tamb√©m validar os ficheiros que est√£o a ser armazenados no Cloud Storage. Vou deixar apenas um exemplo para demonstrar a valida√ß√£o, para n√£o estender demais este artigo:</p><pre name="6376" id="6376" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">match /{imageId}</strong> {<br>  allow write: if request.resource.size &lt; 2 * 1024 * 1024<br>               &amp;&amp; request.resource.contentType.matches(&#39;image/.*&#39;)<br>}</pre><p name="65fa" id="65fa" class="graf graf--p graf-after--pre">Com a regra acima, garantimos que o ficheiro que est√° a ser armazenado:</p><ol class="postList"><li name="77a4" id="77a4" class="graf graf--li graf-after--p">N√£o excede 2 Megabytes;</li><li name="0711" id="0711" class="graf graf--li graf-after--li">√â uma imagem, independentemente do formato (jpg, png, bmp,¬†‚Ä¶).</li></ol><p name="0f06" id="0f06" class="graf graf--p graf-after--li graf--trailing">E esta foi uma introdu√ß√£o √†s Regras do Cloud Storage for Firebase. No pr√≥ximo artigo irei mostrar algumas formas de utilizar os meta-dados dos ficheiros. (<strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Spoiler Alert</em></strong>: vamos come√ßar a desenvolver uma app semelhante ao Google Drive)</p></div></div></section><section name="ee75" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="6b00" id="6b00" class="graf graf--p graf--leading graf--trailing">Caso tenha alguma d√∫vida ou sugest√£o, pode me contactar pelo email <a href="mailto:rosariofernandes51@gmail.com" data-href="mailto:rosariofernandes51@gmail.com" class="markup--anchor markup--p-anchor" target="_blank">rosariofernandes51@gmail.com</a> ou pelo <a href="https://telegram.me/rosariopfernandes" data-href="https://telegram.me/rosariopfernandes" class="markup--anchor markup--p-anchor" rel="nofollow noopener nofollow noopener nofollow noopener nofollow noopener nofollow noopener noopener" target="_blank">Telegram</a>. Ser√° um prazer conversar com voc√™. üôÇ</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@thatfire.dev" class="p-author h-card">Ros√°rio Pereira Fernandes</a> on <a href="https://medium.com/p/8ff8b6fa3d2c"><time class="dt-published" datetime="2018-03-29T19:59:20.044Z">March 29, 2018</time></a>.</p><p><a href="https://medium.com/@thatfire.dev/fbs-8ff8b6fa3d2c" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 24, 2025.</p></footer></article></body></html>