<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Como funcionam as regras de seguran√ßa do Firebase na Realtime Database?</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Como funcionam as regras de seguran√ßa do Firebase na Realtime Database?</h1>
</header>
<section data-field="subtitle" class="p-summary">
Parte 3 ‚Äî Utilizando o Simulador de Regras
</section>
<section data-field="body" class="e-content">
<section name="fb61" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><figure name="2098" id="2098" class="graf graf--figure graf--leading"><img class="graf-image" data-image-id="1*pPbFx3pRph0EOwjkUYc4Uw.png" data-width="1043" data-height="313" src="https://cdn-images-1.medium.com/max/800/1*pPbFx3pRph0EOwjkUYc4Uw.png"><figcaption class="imageCaption">Realtime Database Logo from firebase.google.com/products</figcaption></figure><h3 name="9c2b" id="9c2b" class="graf graf--h3 graf-after--figure graf--title">Como funcionam as regras de seguran√ßa do Firebase na Realtime Database?</h3><h4 name="7ef1" id="7ef1" class="graf graf--h4 graf-after--h3 graf--subtitle">Parte 3‚Ää‚Äî‚ÄäUtilizando o Simulador de¬†Regras</h4><p name="baba" id="baba" class="graf graf--p graf-after--h4">Nos 2 artigos anteriores vimos como utilizar as regras do Firebase Database para: <a href="https://medium.com/android-dev-moz/como-funcionam-as-regras-de-seguran%C3%A7a-do-firebase-na-realtime-database-45b28cda14ad" data-href="https://medium.com/android-dev-moz/como-funcionam-as-regras-de-seguran%C3%A7a-do-firebase-na-realtime-database-45b28cda14ad" class="markup--anchor markup--p-anchor" target="_blank">limitar as escritas e leituras na base de dados</a> e <a href="https://medium.com/android-dev-moz/fbs2-210ce13117e" data-href="https://medium.com/android-dev-moz/fbs2-210ce13117e" class="markup--anchor markup--p-anchor" target="_blank">como validar dados e criar √≠ndices</a>.</p><p name="37b3" id="37b3" class="graf graf--p graf-after--p">Neste artigo, veremos como testar as regras que criamos anteriormente, atrav√©s do simulador de regras inclu√≠do na <a href="http://console.firebase.google.com" data-href="http://console.firebase.google.com" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">consola do Firebase</a>.</p><h3 name="6e35" id="6e35" class="graf graf--h3 graf-after--p">Tipo de simula√ß√£o</h3><p name="3389" id="3389" class="graf graf--p graf-after--h3">A primeira op√ß√£o que nos aparece quando abrimos o simulador pede-nos que escolhamos o tipo de simula√ß√£o: leitura(.read) ou grava√ß√£o(.write).</p><figure name="5515" id="5515" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*haVqMOAE1E4VpUN5HtPxFg.png" data-width="302" data-height="284" src="https://cdn-images-1.medium.com/max/800/1*haVqMOAE1E4VpUN5HtPxFg.png"></figure><h4 name="5169" id="5169" class="graf graf--h4 graf-after--figure">Leitura</h4><p name="37ce" id="37ce" class="graf graf--p graf-after--h4">A leitura permite verificarmos <strong class="markup--strong markup--p-strong">quase</strong> todas as regras que criamos com a chave¬†.read¬†. Basta especificarmos o caminho para o n√≥ de onde queremos ler. Por exemplo:</p><p name="fa4f" id="fa4f" class="graf graf--p graf-after--p">Se quisermos ler os dados de um utilizador, podemos colocar no campo ‚Äú<em class="markup--em markup--p-em">Local</em>‚Äù o direct√≥rio: <code class="markup--code markup--p-code">utilizadores/uid</code> para indicar que vamos ler do n√≥ ‚Äúhttps://id-projecto.firebaseio.com/<strong class="markup--strong markup--p-strong">utilizadores/uid</strong>‚Äù. Tendo as regras definidas para n√£o permitir leituras, teremos um cen√°rio semelhante √† este:</p><figure name="7419" id="7419" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*vK4lDeOIm6gn7kbfJIJoDA.png" data-width="634" data-height="243" src="https://cdn-images-1.medium.com/max/800/1*vK4lDeOIm6gn7kbfJIJoDA.png"></figure><p name="6fe7" id="6fe7" class="graf graf--p graf-after--figure">Repare que al√©m do aviso que a leitura negada, o simulador mostra tamb√©m qual foi a linha onde se encontra a regra que causou a nega√ß√£o. Mas n√£o espere que isto aconte√ßa sempre. Quando as nossas regras s√£o complexas demais, por vezes o Firebase n√£o consegue identificar qual delas est√° a negar a opera√ß√£o e voc√™ ter√° de encontrar o problema sozinho.</p><p name="57af" id="57af" class="graf graf--p graf-after--p">Se as regras definidas permitirem a leitura, o simulador ficar√° mais ou menos assim:</p><figure name="8a47" id="8a47" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*JNL464Y3B3AMY8Mmmyfxtg.png" data-width="635" data-height="245" src="https://cdn-images-1.medium.com/max/800/1*JNL464Y3B3AMY8Mmmyfxtg.png"></figure><h4 name="d17c" id="d17c" class="graf graf--h4 graf-after--figure">Grava√ß√£o</h4><p name="2cd4" id="2cd4" class="graf graf--p graf-after--h4">Permite verificarmos as nossas regras de escrita, atualiza√ß√£o e remo√ß√£o de dados (.write &amp;¬†.validate). Para isso, temos de especificar o caminho onde vamos executar a nossa opera√ß√£o e indicar o JSON que cont√©m os dados que iremos colocar nesse caminho.</p><figure name="444c" id="444c" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*1PYWBh6ohwT8l9izeBzS0Q.png" data-width="303" data-height="188" src="https://cdn-images-1.medium.com/max/800/1*1PYWBh6ohwT8l9izeBzS0Q.png"><figcaption class="imageCaption">Campo onde podemos especificar o JSON que queremos inserir na base de¬†dados</figcaption></figure><p name="19f6" id="19f6" class="graf graf--p graf-after--figure">Por exemplo, podemos testar a escrita de um novo utilizador na base de dados. S√≥ temos de indicar o <em class="markup--em markup--p-em">local</em> <code class="markup--code markup--p-code">/utilizadores/qualquerUid</code>e colocar no campo <em class="markup--em markup--p-em">Dados(JSON)</em> os dados desse utilizador:</p><pre name="471d" id="471d" class="graf graf--pre graf-after--p">{<br>    &quot;nome&quot;: &quot;Bruce Wayne&quot;<br>    &quot;email&quot;: &quot;<a href="mailto:bruce@wayne.co.mz" data-href="mailto:bruce@wayne.co.mz" class="markup--anchor markup--pre-anchor" rel="nofollow" target="_blank">bruce@wayne.co.mz</a>&quot;<br>}</pre><p name="e672" id="e672" class="graf graf--p graf-after--pre">O resultado mostrado na consola ser√° o mesmo da leitura: vermelho para opera√ß√£o negada e verde para opera√ß√£o com sucesso.</p><h3 name="eac7" id="eac7" class="graf graf--h3 graf-after--p">Autentica√ß√£o</h3><p name="160d" id="160d" class="graf graf--p graf-after--h3">Por padr√£o, o simulador de regras executa os testes como se o utilizador que est√° a fazer a leitura/grava√ß√£o n√£o estivesse autenticado (n√£o possui uma conta no Firebase Auth). Isto significa que ao testar as regras que cont√™m <code class="markup--code markup--p-code">auth!=null</code>, elas ser√£o sempre negadas. Por isso, existe a op√ß√£o ‚Äúautenticado‚Äù que permite-nos simular que um utilizador autenticado est√° a fazer a leitura/grava√ß√£o.</p><figure name="843d" id="843d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*amoMmg-IHk7-RflLOILSGQ.png" data-width="302" data-height="485" src="https://cdn-images-1.medium.com/max/800/1*amoMmg-IHk7-RflLOILSGQ.png"></figure><h4 name="2908" id="2908" class="graf graf--h4 graf-after--figure">Provedor</h4><p name="3245" id="3245" class="graf graf--p graf-after--h4">Ao activar a op√ß√£o ‚Äú<em class="markup--em markup--p-em">Autenticado</em>‚Äù, a primeira op√ß√£o que nos surge √© o <em class="markup--em markup--p-em">provedor</em>. Ela permite que especifiquemos o servi√ßo de autentica√ß√£o que queremos simular (Google, Facebook, Twitter, Anonimo, ou at√© um provedor personalizado).</p><h4 name="0eac" id="0eac" class="graf graf--h4 graf-after--p">UID</h4><p name="4789" id="4789" class="graf graf--p graf-after--h4">Outra op√ß√£o que faz parte da autentica√ß√£o √© a possibilidade de indicar o <em class="markup--em markup--p-em">UID</em> do utilizador que est√° a ler/escrever dados. Assim, podemos testar as regras que envolvem verificar o <code class="markup--code markup--p-code">auth.uid</code>.</p><p name="9ee6" id="9ee6" class="graf graf--p graf-after--p">Note que ao utilizar os provedores Google, Facebook, Twitter ou Anonimo, o Firebase mostra um payload (um JSON) de autentica√ß√£o muito simples, com apenas 2 atributos: <code class="markup--code markup--p-code">provider</code> e <code class="markup--code markup--p-code">uid</code>. Estas s√£o as vari√°veis que utilizamos nas nossas regras como <code class="markup--code markup--p-code">auth.provider</code> e <code class="markup--code markup--p-code">auth.uid</code>, respectivamente.</p><p name="a52b" id="a52b" class="graf graf--p graf-after--p">At√© ent√£o n√£o tem problema nenhum. Mas se as nossas regras utilizam outros atributos como por exemplo, o <code class="markup--code markup--p-code">auth.token.email</code> ou <code class="markup--code markup--p-code">auth.token.name</code>, ent√£o estes 4 provedores n√£o podem nos ajudar (pois na simula√ß√£o eles n√£o cont√™m estas vari√°veis por padr√£o). E √© por isso que existe o provedor Custom.</p><h4 name="2a84" id="2a84" class="graf graf--h4 graf-after--p">Custom Auth</h4><p name="e16a" id="e16a" class="graf graf--p graf-after--h4">O provedor custom √© tal igual √† qualquer outro provedor de autentica√ß√£o, a √∫nica diferen√ßa √© que podemos passar um ‚Äú<em class="markup--em markup--p-em">payload</em>‚Äù de autentica√ß√£o personalizado. Isto permite-nos testar regras que utilizam<code class="markup--code markup--p-code"> auth.token.email</code>, <code class="markup--code markup--p-code">auth.token.name</code> ou qualquer outra vari√°vel que faz parte do <code class="markup--code markup--p-code">auth.token</code>.</p><p name="21a3" id="21a3" class="graf graf--p graf-after--p">Por exemplo, se tivermos uma regra que permite criar um novo utilizador s√≥ se ele for o utilizador logado e tiver o mesmo email que consta no Firebase Auth:</p><pre name="9e4f" id="9e4f" class="graf graf--pre graf--startsWithDoubleQuote graf-after--p">‚Äú.write‚Äù:‚Äùauth!=null &amp;&amp; $uid == auth.uid &amp;&amp; newData.child(‚Äòemail‚Äô).val() == auth.token.email‚Äù</pre><p name="9401" id="9401" class="graf graf--p graf-after--pre">Podemos test√°-la com o local ‚Äú/utilizadores/batman/‚Äù e este JSON:</p><pre name="1818" id="1818" class="graf graf--pre graf-after--p">{<br>    &quot;nome&quot;: &quot;Bruce Wayne&quot;,<br>    &quot;email&quot;: &quot;<a href="mailto:bruce@wayne.co.mz" data-href="mailto:bruce@wayne.co.mz" class="markup--anchor markup--pre-anchor" rel="nofollow" target="_blank">bruce@wayne.co.mz</a>&quot;<br>}</pre><p name="bb0d" id="bb0d" class="graf graf--p graf-after--pre">Desde que especifiquemos o email no nosso Payload de Autentica√ß√£o:</p><pre name="a29f" id="a29f" class="graf graf--pre graf-after--p">{<br>  &quot;provider&quot;: &quot;google&quot;,<br>  &quot;uid&quot;: &quot;batman&quot;,<br>  &quot;token&quot;:{<br>    &quot;email&quot;:&quot;<a href="mailto:bruce@wayne.co.mz" data-href="mailto:bruce@wayne.co.mz" class="markup--anchor markup--pre-anchor" rel="nofollow" target="_blank">bruce@wayne.co.mz</a>&quot;<br>  }<br>}</pre><p name="0425" id="0425" class="graf graf--p graf-after--pre">Note que no princ√≠pio do artigo eu mencionei que o simulador permite verificarmos ‚Äúquase‚Äù todas as regras que criamos com a chave¬†<code class="markup--code markup--p-code">.read</code>. Isso porque o simulador ainda n√£o permite testar as <em class="markup--em markup--p-em">query-based rules </em>que vimos no <a href="https://medium.com/android-dev-moz/fbs2-210ce13117e" data-href="https://medium.com/android-dev-moz/fbs2-210ce13117e" class="markup--anchor markup--p-anchor" target="_blank">artigo anterior</a>. Mas espero que eles atualizem o simulador em breve.</p><p name="f61d" id="f61d" class="graf graf--p graf-after--p">Este foi o √∫ltimo artigo das regras de seguran√ßa do Firebase na Realtime Database. No pr√≥ximo artigo da s√©rie irei mostrar as regras de seguran√ßa do Cloud Storage For Firebase.</p><p name="0343" id="0343" class="graf graf--p graf-after--p graf--trailing">Espero que voc√™ j√° seja capaz de criar regras para garantir a seguran√ßa da sua database. Mas</p></div></div></section><section name="1da4" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="731a" id="731a" class="graf graf--p graf--leading graf--trailing">Caso tenha alguma d√∫vida ou sugest√£o, pode me contactar pelo email <a href="mailto:rosariofernandes51@gmail.com" data-href="mailto:rosariofernandes51@gmail.com" class="markup--anchor markup--p-anchor" target="_blank">rosariofernandes51@gmail.com</a> ou pelo <a href="https://telegram.me/rosariopfernandes" data-href="https://telegram.me/rosariopfernandes" class="markup--anchor markup--p-anchor" rel="nofollow noopener nofollow noopener nofollow noopener nofollow noopener noopener nofollow noopener noopener" target="_blank">Telegram</a>. Ser√° um prazer conversar com voc√™. üôÇ</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@thatfire.dev" class="p-author h-card">Ros√°rio Pereira Fernandes</a> on <a href="https://medium.com/p/531abda78169"><time class="dt-published" datetime="2018-03-15T17:01:01.657Z">March 15, 2018</time></a>.</p><p><a href="https://medium.com/@thatfire.dev/fbs3-531abda78169" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 24, 2025.</p></footer></article></body></html>