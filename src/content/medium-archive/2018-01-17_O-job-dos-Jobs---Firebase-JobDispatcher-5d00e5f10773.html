<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>O job dos Jobs ‚Äî Firebase JobDispatcher</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">O job dos Jobs ‚Äî Firebase JobDispatcher</h1>
</header>
<section data-field="subtitle" class="p-summary">
Como agendar Jobs para dispositivos pr√©-lollipop
</section>
<section data-field="body" class="e-content">
<section name="0f8d" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><figure name="e90d" id="e90d" class="graf graf--figure graf--startsWithDoubleQuote graf--leading"><img class="graf-image" data-image-id="1*hSsWSlm1-R6TDrVwEmDmaQ.png" data-width="800" data-height="240" src="https://cdn-images-1.medium.com/max/800/1*hSsWSlm1-R6TDrVwEmDmaQ.png"><figcaption class="imageCaption">‚ÄúFire bass Bob the butcher?‚Äù</figcaption></figure><h3 name="18a4" id="18a4" class="graf graf--h3 graf-after--figure graf--title">O job dos Jobs‚Ää‚Äî‚ÄäFirebase JobDispatcher</h3><h4 name="4d90" id="4d90" class="graf graf--h4 graf-after--h3 graf--subtitle">Como agendar Jobs para dispositivos pr√©-lollipop</h4><p name="39b6" id="39b6" class="graf graf--p graf-after--h4"><strong class="markup--strong markup--p-strong">Este artigo √© parte da s√©rie ‚ÄúO job dos Jobs‚Äù:</strong></p><ol class="postList"><li name="aebc" id="aebc" class="graf graf--li graf-after--p"><a href="https://medium.com/@rosariopfernandes/job1-6506d5c4a7ae" data-href="https://medium.com/@rosariopfernandes/job1-6506d5c4a7ae" class="markup--anchor markup--li-anchor" target="_blank">Qual √© o job dos Jobs?</a></li><li name="8859" id="8859" class="graf graf--li graf-after--li"><a href="https://medium.com/@rosariopfernandes/job2-fbf022368795" data-href="https://medium.com/@rosariopfernandes/job2-fbf022368795" class="markup--anchor markup--li-anchor" target="_blank">O job dos Jobs‚Ää‚Äî‚ÄäJobServices</a></li><li name="56e8" id="56e8" class="graf graf--li graf-after--li graf--trailing"><a href="https://medium.com/@rosariopfernandes/job3-5d00e5f10773" data-href="https://medium.com/@rosariopfernandes/job3-5d00e5f10773" class="markup--anchor markup--li-anchor" target="_blank">O job dos Jobs‚Ää‚Äî‚ÄäFirebase JobDispatcher</a></li></ol></div></div></section><section name="3d15" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="56cf" id="56cf" class="graf graf--p graf--leading">Agora que j√° <a href="https://medium.com/android-dev-moz/job1-6506d5c4a7ae" data-href="https://medium.com/android-dev-moz/job1-6506d5c4a7ae" class="markup--anchor markup--p-anchor" target="_blank">conhecemos os jobs</a> e sabemos <a href="https://medium.com/android-dev-moz/job2-fbf022368795" data-href="https://medium.com/android-dev-moz/job2-fbf022368795" class="markup--anchor markup--p-anchor" target="_blank">como criar JobServices</a> est√° na hora de saber como utilizar o <a href="https://github.com/firebase/firebase-jobdispatcher-android" data-href="https://github.com/firebase/firebase-jobdispatcher-android" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Firebase JobDispatcher</a> para agendar estes jobs.</p><p name="d453" id="d453" class="graf graf--p graf-after--p">No <a href="https://medium.com/p/6506d5c4a7ae" data-href="https://medium.com/p/6506d5c4a7ae" class="markup--anchor markup--p-anchor" target="_blank">primeiro artigo da s√©rie</a> j√° tinhamos visto o que √© o Firebase JobDispatcher e como agendar um Job simples. Neste artigo vou procurar detalhar melhor como agendar jobs mais complexos.</p><blockquote name="6757" id="6757" class="graf graf--blockquote graf-after--p">Firebase JobDispatcher √© uma biblioteca para agendar Jobs que ser√£o executados em segundo plano na sua aplica√ß√£o. Ela permite realizar o mesmo que o JobScheduler em dispositivos Android com API superior a 9, desde que tenham Google Play Services instalado.</blockquote><p name="32ee" id="32ee" class="graf graf--p graf-after--blockquote">Vamos come√ßar por adicionar o Firebase Job Dispatcher ao nosso projecto. Para isso, s√≥ temos de colocar a depend√™ncia no build.gradle da app:</p><pre name="3708" id="3708" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0"><strong class="markup--strong markup--pre-strong">implementation</strong> <em class="markup--em markup--pre-em">&#39;com.firebase:firebase-jobdispatcher:0.8.5&#39;</em></code></pre><p name="8d07" id="8d07" class="graf graf--p graf-after--pre">De seguida, criamos o nosso JobService como <a href="https://medium.com/p/fbf022368795" data-href="https://medium.com/p/fbf022368795" class="markup--anchor markup--p-anchor" target="_blank">no artigo anterior</a> (n√£o vou colocar o c√≥digo aqui para n√£o tornar o artigo muito longo).</p><p name="5e52" id="5e52" class="graf graf--p graf-after--p">E ent√£o j√° podemos agendar o nosso Job instanciando FirebaseJobDispatcher:</p><pre name="9192" id="9192" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">FirebaseJobDispatcher</strong> dispatcher = new <strong class="markup--strong markup--pre-strong">FirebaseJobDispatcher</strong>(new <strong class="markup--strong markup--pre-strong">GooglePlayDriver</strong>(context));</pre><p name="3b8a" id="3b8a" class="graf graf--p graf-after--pre">E de seguida criar o job e passar para o dispatcher agend√°-lo:</p><figure name="2846" id="2846" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/rosariopfernandes/e939311135c5a4323a63cee417d52ffc#file-mainactivity-java.js"></script></figure><p name="1411" id="1411" class="graf graf--p graf-after--figure">Repare que o job deste exemplo leva muitos par√¢metros. Mas isso √© porque eu quero explicar alguns deles. Mas um Job simples s√≥ precisa de no m√≠nimo 2 par√¢metros: o service(setService) e a tag(setTag).</p><p name="87b9" id="87b9" class="graf graf--p graf-after--p">Vamos ent√£o analisar os par√¢metros.</p><h3 name="e79e" id="e79e" class="graf graf--h3 graf-after--p">Par√¢metros simples</h3><p name="4b49" id="4b49" class="graf graf--p graf-after--h3">Vou come√ßar pelos mais simples:</p><ul class="postList"><li name="fd66" id="fd66" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Service</strong>‚Ää‚Äî‚Ääindicamos qual √© o JobService a ser executado;</li><li name="c227" id="c227" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Tag</strong>‚Ää‚Äî‚Ääpassamos uma String capaz de identificar unicamente o nosso job. √â o ID do job. √â ele que indica qual ao sistema qual job iniciar/terminar.</li><li name="f5f4" id="f5f4" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">replaceCurrent</strong>‚Ää‚Äî‚Ääse existir um job com a mesma tag j√° agendado, o sistema deve substitu√≠-lo(<strong class="markup--strong markup--li-strong">true</strong>)? Ou manter o j√° existente(<strong class="markup--strong markup--li-strong">false</strong>)? O padr√£o √© <strong class="markup--strong markup--li-strong">false</strong>.</li><li name="135f" id="135f" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Lifetime</strong>‚Ää‚Äî‚Ääespecifica quanto tempo o Job deve durar. As op√ß√µes s√£o: Lifetime.<strong class="markup--strong markup--li-strong">UNTIL_NEXT_BOOT</strong> e Lifetime.<strong class="markup--strong markup--li-strong">FOREVER</strong>. A primeira indica que o job vai durar s√≥ at√© o dispositivo android ser desligado e a √∫ltima indica que o job deve durar para sempre. Mesmo que o dispositivo seja reiniciado. O padr√£o √© <strong class="markup--strong markup--li-strong">UNTIL_NEXT_BOOT.</strong></li></ul><h3 name="f37e" id="f37e" class="graf graf--h3 graf-after--li">Par√¢metros complexos</h3><p name="600b" id="600b" class="graf graf--p graf-after--h3">Agora que conhecemos os par√¢metros mais simples, vamos avan√ßar para os que apresentam mais de 2 op√ß√µes:</p><h4 name="e8dc" id="e8dc" class="graf graf--h4 graf-after--p">RetryStrategy</h4><p name="e7eb" id="e7eb" class="graf graf--p graf-after--h4">RetryStrategy √© o par√¢metro que ajuda a controlar o job quando ele falha. Ao falhar, o JobDispatcher espera algum tempo (30 segundos por padr√£o) antes de voltar a executar o job falhado e esse tempo √© incrementado cada vez que o job falha. O valor deste incremento depende do Retry Strategy:</p><ul class="postList"><li name="a02f" id="a02f" class="graf graf--li graf-after--p">RetryStrategy.<strong class="markup--strong markup--li-strong">RETRY_POLICY_EXPONENTIAL</strong>‚Ää‚Äî‚Ääeste √© o padr√£o. Ele aumenta o tempo de espera de forma exponencial com a f√≥rmula:</li></ul><blockquote name="b74b" id="b74b" class="graf graf--pullquote graf-after--li">tempo = tempoInicial * 2 ^ (numeroDeFalhas‚Ää‚Äî‚Ää1)</blockquote><ul class="postList"><li name="33a2" id="33a2" class="graf graf--li graf-after--pullquote">RetryStrategy.<strong class="markup--strong markup--li-strong">RETRY_POLICY_LINEAR</strong>‚Ää‚Äî‚Ääaumenta o tempo de espera de forma linear com a f√≥rmula:</li></ul><blockquote name="d1bf" id="d1bf" class="graf graf--pullquote graf-after--li">tempo = tempoInicial * numeroDeFalhas</blockquote><ul class="postList"><li name="0d56" id="0d56" class="graf graf--li graf-after--pullquote">RetryStrategy.<strong class="markup--strong markup--li-strong">DEFAULT_EXPONENTIAL‚Ää‚Äî‚Ää</strong>vai dobrando o tempo de espera (30, 60, 120, 240,¬†‚Ä¶);</li><li name="9da2" id="9da2" class="graf graf--li graf-after--li">RetryStrategy.<strong class="markup--strong markup--li-strong">DEFAULT_LINEAR‚Ää‚Äî‚Ää</strong>vai incrementando 30s (30, 60, 90, 120,¬†‚Ä¶).</li></ul><p name="bfdf" id="bfdf" class="graf graf--p graf-after--li">Voc√™ deve estar a pensar: <em class="markup--em markup--p-em">Se o tempo vai incrementando, ent√£o pode acontecer o caso do job s√≥ voltar a ser executado no dia seguinte?</em> A resposta √© <strong class="markup--strong markup--p-strong">N√£o</strong>. O incremento m√°ximo √© 3600s (1 hora). Depois disso, o tempo de espera volta a ser 30s.</p><h4 name="9460" id="9460" class="graf graf--h4 graf-after--p">Constraints</h4><p name="ff63" id="ff63" class="graf graf--p graf-after--h4">Os Constraints ajudam a definir em que condi√ß√µes o dispositivo deve estar para que o nosso job possa ser executado. O JobDispatcher possui actualmente 4 Constraints:</p><ul class="postList"><li name="88f0" id="88f0" class="graf graf--li graf-after--p">Constraint.<strong class="markup--strong markup--li-strong">ON_UNMETERED_NETWORK</strong>‚Ää‚Äî‚Ääquando o dispositivo est√° conectado √† uma rede n√£o limitada como uma rede Wi-Fi, por exemplo.</li><li name="9216" id="9216" class="graf graf--li graf-after--li">Constraint.<strong class="markup--strong markup--li-strong">ON_ANY_NETWORK</strong>‚Ää‚Äî‚Ääquando o dispositivo est√° conectado √† uma rede. N√£o interessa o limite. (Se voc√™ passar esta constraint e a primeira para o mesmo job, a primeira ter√° prioridade)</li><li name="079b" id="079b" class="graf graf--li graf-after--li">Constraint.<strong class="markup--strong markup--li-strong">DEVICE_CHARGING</strong>‚Ää‚Äî‚Ääquando o dispositivo est√° a carregar (ligado √† corrente).</li><li name="8a6b" id="8a6b" class="graf graf--li graf-after--li">Constraint.<strong class="markup--strong markup--li-strong">DEVICE_IDLE‚Ää</strong>‚Äî‚Ääquando o dispositivo est√° em ‚ÄúModo repouso‚Äù‚Ää‚Äî‚Ääquando n√£o est√° a ser utilizado (provavelmente com o ecr√£ apagado).</li></ul><p name="67d4" id="67d4" class="graf graf--p graf-after--li">N√£o se esque√ßa que voc√™ pode especificar mais de um Constraint, desde que use v√≠rgulas para separ√°-los.</p><h4 name="9cc3" id="9cc3" class="graf graf--h4 graf-after--p">Extras</h4><p name="f69a" id="f69a" class="graf graf--p graf-after--h4">Permite-nos passar valores extras para o nosso JobService. Basta colocarmos esses valores num <em class="markup--em markup--p-em">Bundle:</em></p><pre name="fefc" id="fefc" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">Bundle</strong> extras = new <strong class="markup--strong markup--pre-strong">Bundle</strong>();<br>extras.putInt(&quot;idProducto&quot;, 2);<br>extras.putString(&quot;nome&quot;, &quot;Firebase&quot;);</pre><p name="2aa1" id="2aa1" class="graf graf--p graf-after--pre">Depois podemos aceder a esses extras no JobService atrav√©s do JobParameters:</p><pre name="5308" id="5308" class="graf graf--pre graf-after--p">@Override<br>public <strong class="markup--strong markup--pre-strong">boolean</strong> onStartJob(<strong class="markup--strong markup--pre-strong">JobParameters</strong> job) {<br>    <strong class="markup--strong markup--pre-strong">Bundle</strong> extras = job.getExtras();<br>    <strong class="markup--strong markup--pre-strong">int</strong> id = extras.getInt(&quot;idProducto&quot;,0);<br>    <strong class="markup--strong markup--pre-strong">String</strong> nome = extras.getString(&quot;nome&quot;);<br>    return false;<br>}</pre><h3 name="23d6" id="23d6" class="graf graf--h3 graf-after--pre">Cancelar Jobs</h3><p name="f53e" id="f53e" class="graf graf--p graf-after--h3">Se voc√™ em algum momento precisar de cancelar um Job pode usar o c√≥digo:</p><pre name="20cc" id="20cc" class="graf graf--pre graf-after--p">dispatcher.cancel(&quot;MyUploadJob&quot;); //repare que a String passada √© a tag que utilizamos na cria√ß√£o do job</pre><p name="badd" id="badd" class="graf graf--p graf-after--pre">Ou se quiser cancelar todos os Jobs agendados pela aplica√ß√£o:</p><pre name="2aa4" id="2aa4" class="graf graf--pre graf-after--p">dispatcher.cancelAll();</pre><p name="5cc8" id="5cc8" class="graf graf--p graf-after--pre graf--trailing">E pronto. Se voc√™ chegou at√© aqui j√° deve saber tudo sobre Jobs no Android, pois este √© o √∫ltimo artigo da s√©rie ‚ÄúO job dos Jobs‚Äù.</p></div></div></section><section name="78e5" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="1845" id="1845" class="graf graf--p graf--leading graf--trailing">Se voc√™ tem alguma d√∫vida ou sugest√£o, n√£o hesite em me contactar pelo email <a href="mailto:rosariofernandes51@gmail.com" data-href="mailto:rosariofernandes51@gmail.com" class="markup--anchor markup--p-anchor" target="_blank">rosariofernandes51@gmail.com</a> ou pelo <a href="https://telegram.me/rosariopfernandes" data-href="https://telegram.me/rosariopfernandes" class="markup--anchor markup--p-anchor" rel="nofollow noopener nofollow noopener nofollow noopener nofollow noopener nofollow noopener noopener noopener noopener" target="_blank">Telegram</a>. Ficarei feliz por conversar com voc√™. üôÇ</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@thatfire.dev" class="p-author h-card">Ros√°rio Pereira Fernandes</a> on <a href="https://medium.com/p/5d00e5f10773"><time class="dt-published" datetime="2018-01-17T19:01:03.156Z">January 17, 2018</time></a>.</p><p><a href="https://medium.com/@thatfire.dev/job3-5d00e5f10773" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 24, 2025.</p></footer></article></body></html>