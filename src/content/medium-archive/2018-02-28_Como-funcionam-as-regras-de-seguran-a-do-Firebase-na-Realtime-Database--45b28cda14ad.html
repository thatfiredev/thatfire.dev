<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Como funcionam as regras de seguranÃ§a do Firebase na Realtime Database?</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Como funcionam as regras de seguranÃ§a do Firebase na Realtime Database?</h1>
</header>
<section data-field="subtitle" class="p-summary">
Parte 1 â€” Leituras e Escritas
</section>
<section data-field="body" class="e-content">
<section name="3b23" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><figure name="e2d5" id="e2d5" class="graf graf--figure graf--leading"><img class="graf-image" data-image-id="1*pPbFx3pRph0EOwjkUYc4Uw.png" data-width="1043" data-height="313" src="https://cdn-images-1.medium.com/max/800/1*pPbFx3pRph0EOwjkUYc4Uw.png"><figcaption class="imageCaption">Realtime Database Logo from firebase.google.com/products</figcaption></figure><h3 name="2420" id="2420" class="graf graf--h3 graf-after--figure graf--title">Como funcionam as regras de seguranÃ§a do Firebase na Realtime Database?</h3><h4 name="7654" id="7654" class="graf graf--h4 graf-after--h3 graf--subtitle">Parte 1â€Šâ€”â€ŠLeituras eÂ Escritas</h4><p name="7b1d" id="7b1d" class="graf graf--p graf-after--h4">Quando desenvolvemos aplicaÃ§Ãµes, um aspeto importante a ter em conta Ã© a seguranÃ§a. NinguÃ©m gostaria de ouvir utilizadores a reclamarem por terem perdido dados na sua aplicaÃ§Ã£o, nem gostaria de acordar um dia e descobrir que a aplicaÃ§Ã£o que levou meses para desenvolver simplesmente nÃ£o existe mais.<br>E o Firebase Ã© uma plataforma que permite desenvolver aplicaÃ§Ãµes de forma fÃ¡cil e rÃ¡pida. Esta plataforma resolve maior parte das preocupaÃ§Ãµes de um desenvolvedor, mas feliz ou infelizmente a seguranÃ§a fica por nossa conta.</p><p name="0630" id="0630" class="graf graf--p graf-after--p">Uso Firebase jÃ¡ hÃ¡ quase 2 anos e atÃ© alguns dias atrÃ¡s ainda deixava as minhas security rules no modo prÃ©-definido (<code class="markup--code markup--p-code">auth!=null</code>), pois achava que isto deixava os meus dados seguros. Mas nÃ£o Ã© bem assim, e Ã© isso que eu vou explicar neste artigo.</p><p name="84ca" id="84ca" class="graf graf--p graf-after--p">Vamos comeÃ§ar por entender o que significa o <code class="markup--code markup--p-code">auth!=null</code> e porquÃª nÃ£o Ã© seguro: esta regra indica que a base de dados sÃ³ pode ser acedida por utilizadores autenticados, o que significa que Ã© preciso ter uma conta na sua aplicaÃ§Ã£o para poder aceder os dados. Assim os utilizadores podem manipular dados de outros utilizadores, e atÃ© dos administradores (caso existam na aplicaÃ§Ã£o). E Ã© por isso que temos que criar regras mais restritivas para impedir tais aÃ§Ãµes.</p><h3 name="e86e" id="e86e" class="graf graf--h3 graf-after--p">Conhecendo as SecurityÂ Rules</h3><p name="6991" id="6991" class="graf graf--p graf-after--h3">As regras de seguranÃ§a nÃ£o sÃ£o nada mais que uma Ã¡rvore JSON. E em Ã¡rvores, temos 3 conceitos conhecidos: <strong class="markup--strong markup--p-strong">nÃ³</strong>, <strong class="markup--strong markup--p-strong">chave</strong> e <strong class="markup--strong markup--p-strong">valor</strong>.</p><figure name="c617" id="c617" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*5z2caK1zf3Uy-ZJDzpAy-A.png" data-width="712" data-height="630" src="https://cdn-images-1.medium.com/max/800/1*5z2caK1zf3Uy-ZJDzpAy-A.png"></figure><p name="c649" id="c649" class="graf graf--p graf-after--figure">Todas as nossas regras ficam em um <strong class="markup--strong markup--p-strong">nÃ³</strong> denominado â€œrulesâ€. E como deu para notar, nesse nÃ³ temos 2 <strong class="markup--strong markup--p-strong">chaves</strong>: â€œ.readâ€ e â€œ.writeâ€. Nas nossas regras, os <strong class="markup--strong markup--p-strong">valores </strong>destas 2 chaves tÃªm de ser do tipo booleano para indicar as condiÃ§Ãµes de acesso Ã  base de dados(<code class="markup--code markup--p-code">true</code> para permitir o acesso e/ou <code class="markup--code markup--p-code">false</code> para negar o acesso).</p><h4 name="0944" id="0944" class="graf graf--h4 graf-after--p">As chaves</h4><p name="f338" id="f338" class="graf graf--p graf-after--h4">Dentro de cada nÃ³, podemos ter no mÃ¡ximo 4 chaves:</p><ul class="postList"><li name="72e5" id="72e5" class="graf graf--li graf--startsWithDoubleQuote graf-after--p"><code class="markup--code markup--li-code">â€œ.readâ€â€Š</code>â€”â€Ša condiÃ§Ã£o para que possam ser feitas operaÃ§Ãµes de leitura na base de dados.</li><li name="9d39" id="9d39" class="graf graf--li graf--startsWithDoubleQuote graf-after--li"><code class="markup--code markup--li-code">â€œ.writeâ€</code>â€Šâ€”â€Ša condiÃ§Ã£o para que possam ser feitas operaÃ§Ãµes de escrita na base de dados.</li><li name="b748" id="b748" class="graf graf--li graf--startsWithDoubleQuote graf-after--li"><code class="markup--code markup--li-code">â€œ.validateâ€</code>â€Šâ€”â€ŠnÃ£o Ã© exatamente uma condiÃ§Ã£o, mas se o retorno for <code class="markup--code markup--li-code">false</code> impede a escrita na base de dados. EntÃ£o o retorno deve ser sempre <code class="markup--code markup--li-code">true</code>, depois de validar o valor. (mais detalhes neste mesmo artigo)</li><li name="3003" id="3003" class="graf graf--li graf--startsWithDoubleQuote graf-after--li"><code class="markup--code markup--li-code">â€œ.indexOnâ€</code>- nÃ£o Ã© uma condiÃ§Ã£o: indica ao firebase que Ã­ndice utilizar para ordenar dados na database.</li></ul><p name="46b4" id="46b4" class="graf graf--p graf-after--li">Nota: Neste artigo irei focar mais nas 2 primeiras chaves, deixando as outras 2 para o prÃ³ximo artigo.</p><h4 name="45bc" id="45bc" class="graf graf--h4 graf-after--p">Os nÃ³s</h4><p name="d85c" id="d85c" class="graf graf--p graf-after--h4">Como jÃ¡ vimos, a base de dados comeÃ§a com o nÃ³ â€œrulesâ€. Mas podemos definir sub-nÃ³s para cada nÃ³ da Realtime Database. (Meio confuso, eu sei ğŸ˜)</p><p name="5879" id="5879" class="graf graf--p graf-after--p">Vamos ver um exemplo. Se a nossa Realtime Database tiver 2 nÃ³s: utilizadores e mensagens.</p><pre name="1c69" id="1c69" class="graf graf--pre graf-after--p">{<br>    â€œutilizadoresâ€:{<br>        //â€¦lista de utilizadores<br>    },<br>    â€œmensagensâ€:{<br>        //â€¦lista de mensagens<br>    }<br>}</pre><p name="ae97" id="ae97" class="graf graf--p graf-after--pre">Podemos definir regras diferentes para estes nÃ³s, basta criar 2 sub-nÃ³s em â€œrulesâ€:</p><pre name="99ac" id="99ac" class="graf graf--pre graf-after--p">{<br>    â€œ<strong class="markup--strong markup--pre-strong">rules</strong>â€:{<br>        â€œ<strong class="markup--strong markup--pre-strong">utilizadores</strong>â€:{<br>            â€œ<strong class="markup--strong markup--pre-strong">.write</strong>â€:â€auth!=uidâ€,<br>            â€œ<strong class="markup--strong markup--pre-strong">.read</strong>â€:â€auth!=uidâ€<br>        },<br>        â€œ<strong class="markup--strong markup--pre-strong">mensagens</strong>â€:{<br>            â€œ<strong class="markup--strong markup--pre-strong">.write</strong>â€:â€auth!=uidâ€,<br>            â€œ<strong class="markup--strong markup--pre-strong">.read</strong>â€: true<br>        }<br>    }<br>}</pre><p name="d75e" id="d75e" class="graf graf--p graf-after--pre">Assim, qualquer um pode ler as mensagens, mas apenas utilizadores da aplicaÃ§Ã£o podem escrever mensagens e escrever/ler dados dos utilizadores. (<strong class="markup--strong markup--p-strong">AtenÃ§Ã£o que isto continua nÃ£o sendo seguro, apenas utilizei como exemplo para demonstrar a funcionalidade dos sub-nÃ³s</strong>).</p><h4 name="0733" id="0733" class="graf graf--h4 graf-after--p">Os valores</h4><p name="4240" id="4240" class="graf graf--p graf-after--h4">Como jÃ¡ tinha dito, os valores de â€œ.readâ€ e de â€œ.writeâ€ devem sempre retornar um <code class="markup--code markup--p-code">boolean</code>. E para fazer isso, o Firebase dÃ¡-nos acesso Ã  mais algumas variÃ¡veis:</p><p name="62ba" id="62ba" class="graf graf--p graf-after--p"><a href="https://firebase.google.com/docs/reference/security/database/#auth" data-href="https://firebase.google.com/docs/reference/security/database/#auth" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">auth</strong></a></p><p name="b337" id="b337" class="graf graf--p graf-after--p">JÃ¡ conhecÃ­amos esta variÃ¡vel, ela representa um utilizador autenticado. AtravÃ©s dela podemos acessar 3 outras variÃ¡veis: <strong class="markup--strong markup--p-strong">uid</strong>(id do utilizador autenticado), <strong class="markup--strong markup--p-strong">provider</strong>(mÃ©todo de login utilizado, pode ser â€œpasswordâ€, â€œfacebookâ€, â€œgoogleâ€, â€œtwitterâ€, â€œgithubâ€ ou â€œanonymousâ€) e <strong class="markup--strong markup--p-strong">token </strong>que <a href="https://firebase.google.com/docs/reference/security/database/#authtoken" data-href="https://firebase.google.com/docs/reference/security/database/#authtoken" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">contÃ©m mais variÃ¡veis</a> (como por exemplo o nome e email do utilizador autenticado);</p><p name="6d09" id="6d09" class="graf graf--p graf-after--p">Podemos utilizar esta variÃ¡vel, por exemplo, para que os utilizadores autenticados acessem apenas os seus prÃ³prios dados:</p><pre name="ea02" id="ea02" class="graf graf--pre graf-after--p">&quot;utilizadores&quot;:{<br>    &quot;$uid&quot;:{<br>        &quot;.write&quot;:&quot;auth!=null &amp;&amp; $uid == auth.uid&quot;,<br>        &quot;.read&quot;:&quot;auth!=null &amp;&amp; $uid == auth.uid&quot;<br>    }<br> }</pre><p name="4133" id="4133" class="graf graf--p graf-after--pre">Com estas regras, o utilizador Paulo nÃ£o tem permissÃ£o para aceder aos dados do JoÃ£o.</p><p name="058a" id="058a" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">$ (cifrÃ£o)</strong></p><p name="59af" id="59af" class="graf graf--p graf-after--p">De certeza que vocÃª viu este sÃ­mbolo no exemplo anterior. <a href="https://www.w3schools.com/php/php_variables.asp" data-href="https://www.w3schools.com/php/php_variables.asp" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Tal como no PHP</a>, ele serve para indicar que trata-se de uma variÃ¡vel. A ideia de declarar estas variÃ¡veis nÃ£o Ã© atribuir valores Ã  elas, mas sim utilizar elas para comparar os seus valores com outros, tal como no exemplo anterior onde comparamos se o <code class="markup--code markup--p-code">uid</code> do utilizador que estÃ¡ na base de dados (variÃ¡vel <code class="markup--code markup--p-code">$uid</code>) Ã© igual ao uid do utilizador que fez o login no firebase auth (variÃ¡vel <code class="markup--code markup--p-code">auth.uid</code>).</p><h4 name="ba7f" id="ba7f" class="graf graf--h4 graf-after--p">root</h4><p name="1451" id="1451" class="graf graf--p graf-after--h4">Tal como o nome indica, esta variÃ¡vel corresponde ao nÃ³ raiz da nossa base de dados. AtravÃ©s dela podemos aceder Ã  outros dados que estÃ£o fora do nÃ³ que estamos a tentar ler/escrever.</p><p name="9436" id="9436" class="graf graf--p graf-after--p">Por exemplo, supondo que temos mais um nÃ³ â€œgruposâ€:</p><figure name="e99a" id="e99a" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/rosariopfernandes/2728063175d9a6605727ce62ad91163c.js"></script></figure><p name="4855" id="4855" class="graf graf--p graf-after--figure">Podemos escrever uma regra de seguranÃ§a para que o utilizador sÃ³ possa ler/escrever mensagens em grupos que ele faz parte:</p><figure name="a9a9" id="a9a9" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/rosariopfernandes/1af86c482a7628b987a99b4bac8ea72b.js"></script></figure><h4 name="1ed2" id="1ed2" class="graf graf--h4 graf-after--figure">data</h4><p name="b03b" id="b03b" class="graf graf--p graf-after--h4">Esta variÃ¡vel contem os dados que estÃ£o atualmente nesse nÃ³ onde pretendemos ler/escrever.</p><h4 name="4632" id="4632" class="graf graf--h4 graf-after--p">newData</h4><p name="188b" id="188b" class="graf graf--p graf-after--h4">Diferentemente da variÃ¡vel <code class="markup--code markup--p-code">data</code>, esta variÃ¡vel sÃ³ pode ser acedida quando estamos a fazer uma escrita (.write) ou validaÃ§Ã£o (.validate). Ela contÃ©m os dados que serÃ£o escritos nesse nÃ³. Podemos utilizar em conjunto com a variÃ¡vel <code class="markup--code markup--p-code">data</code>, por exemplo, quando estamos a atualizar a data em que um utilizador esteve online pela Ãºltima vez:</p><pre name="e027" id="e027" class="graf graf--pre graf--startsWithDoubleQuote graf-after--p">â€œ<strong class="markup--strong markup--pre-strong">uid1</strong>â€:{<br>    â€œ<strong class="markup--strong markup--pre-strong">nome</strong>â€:â€RosÃ¡rioâ€,<br>    â€œ<strong class="markup--strong markup--pre-strong">visto</strong>â€:â€201802282030&quot; //timestamp da data em que o utilizador foi visto pela Ãºltima vez<br> }</pre><figure name="af56" id="af56" class="graf graf--figure graf--iframe graf-after--pre"><script src="https://gist.github.com/rosariopfernandes/0b4ed9b1b6965fe60e3465db46f20ad5.js"></script></figure><h3 name="35cb" id="35cb" class="graf graf--h3 graf-after--figure">MÃ©todos/FunÃ§Ãµes adicionais</h3><p name="9c01" id="9c01" class="graf graf--p graf-after--h3">As variÃ¡veis <code class="markup--code markup--p-code">root</code>, <code class="markup--code markup--p-code">data</code> e <code class="markup--code markup--p-code">newData</code> sÃ£o como se fossem os <code class="markup--code markup--p-code">DataSnapshot</code> que nÃ³s conhecemos (sim, aqueles que utilizamos quando lemos dados da Realtime Database). Isso significa que eles tÃªm os mesmos mÃ©todos que existem em um <code class="markup--code markup--p-code">DataSnapshot</code>:</p><ul class="postList"><li name="dec2" id="dec2" class="graf graf--li graf-after--p"><code class="markup--code markup--li-code">val()</code></li><li name="9d11" id="9d11" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">child()</code></li><li name="ca5c" id="ca5c" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">parent()</code></li><li name="08d0" id="08d0" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">hasChild()</code></li><li name="f2ad" id="f2ad" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">exists()</code></li><li name="123f" id="123f" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">getPriority()</code></li></ul><p name="07e1" id="07e1" class="graf graf--p graf-after--li">Mas para alÃ©m destes mÃ©todos, existem mais 3 mÃ©todos para verificar o tipo de dado:</p><ul class="postList"><li name="5e17" id="5e17" class="graf graf--li graf-after--p"><code class="markup--code markup--li-code">isString()</code></li><li name="549f" id="549f" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">isNumber()</code></li><li name="12f5" id="12f5" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">isBoolean()</code></li></ul><p name="d97f" id="d97f" class="graf graf--p graf-after--li">E Ã© tudo para este artigo. Espero que vocÃª tenha aprendido a utilizar as regras de seguranÃ§a e que comece a implementar nos seus projetos (se ainda nÃ£o o fazia) para termos aplicaÃ§Ãµes mais seguras.Â :)</p><p name="c81f" id="c81f" class="graf graf--p graf-after--p">No <a href="https://medium.com/android-dev-moz/fbs2-210ce13117e" data-href="https://medium.com/android-dev-moz/fbs2-210ce13117e" class="markup--anchor markup--p-anchor" target="_blank">prÃ³ximo artigo</a> explico as regrasÂ <code class="markup--code markup--p-code">.validate</code> eÂ <code class="markup--code markup--p-code">.indexOn</code>Â :</p><div name="50de" id="50de" class="graf graf--mixtapeEmbed graf-after--p graf--trailing"><a href="https://medium.com/android-dev-moz/fbs2-210ce13117e" data-href="https://medium.com/android-dev-moz/fbs2-210ce13117e" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/android-dev-moz/fbs2-210ce13117e"><strong class="markup--strong markup--mixtapeEmbed-strong">Como funcionam as regras de seguranÃ§a do Firebase na Realtime Database?</strong><br><em class="markup--em markup--mixtapeEmbed-em">Parte 2â€Šâ€”â€ŠValidaÃ§Ãµes e Ãndices</em>medium.com</a><a href="https://medium.com/android-dev-moz/fbs2-210ce13117e" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="fcff781b34332d7b856426450f80c8fc" data-thumbnail-img-id="1*pPbFx3pRph0EOwjkUYc4Uw.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*pPbFx3pRph0EOwjkUYc4Uw.png);"></a></div></div></div></section><section name="44e8" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="acab" id="acab" class="graf graf--p graf--leading">Caso tenha alguma dÃºvida ou sugestÃ£o, pode me contactar pelo email <a href="mailto:rosariofernandes51@gmail.com" data-href="mailto:rosariofernandes51@gmail.com" class="markup--anchor markup--p-anchor" target="_blank">rosariofernandes51@gmail.com</a> ou pelo <a href="https://telegram.me/rosariopfernandes" data-href="https://telegram.me/rosariopfernandes" class="markup--anchor markup--p-anchor" rel="nofollow noopener nofollow noopener nofollow noopener nofollow noopener noopener" target="_blank">Telegram</a>. SerÃ¡ um prazer conversar com vocÃª. ğŸ™‚</p><p name="fb0d" id="fb0d" class="graf graf--p graf-after--p graf--trailing">*Thanks for the review <a href="https://medium.com/u/bda34d240011" data-href="https://medium.com/u/bda34d240011" data-anchor-type="2" data-user-id="bda34d240011" data-action-value="bda34d240011" data-action="show-user-card" data-action-type="hover" class="markup--user markup--p-user" target="_blank">Paulo Enoque</a></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@thatfire.dev" class="p-author h-card">RosÃ¡rio Pereira Fernandes</a> on <a href="https://medium.com/p/45b28cda14ad"><time class="dt-published" datetime="2018-02-28T18:51:46.464Z">February 28, 2018</time></a>.</p><p><a href="https://medium.com/@thatfire.dev/como-funcionam-as-regras-de-seguran%C3%A7a-do-firebase-na-realtime-database-45b28cda14ad" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 24, 2025.</p></footer></article></body></html>