<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Como funcionam as regras de seguran√ßa do Firebase na Realtime Database?</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Como funcionam as regras de seguran√ßa do Firebase na Realtime Database?</h1>
</header>
<section data-field="subtitle" class="p-summary">
Parte 2 ‚Äî Valida√ß√µes e √çndices
</section>
<section data-field="body" class="e-content">
<section name="d352" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><figure name="2215" id="2215" class="graf graf--figure graf--leading"><img class="graf-image" data-image-id="1*pPbFx3pRph0EOwjkUYc4Uw.png" data-width="1043" data-height="313" src="https://cdn-images-1.medium.com/max/800/1*pPbFx3pRph0EOwjkUYc4Uw.png"><figcaption class="imageCaption">Realtime Database Logo from firebase.google.com/products</figcaption></figure><h3 name="2605" id="2605" class="graf graf--h3 graf-after--figure graf--title">Como funcionam as regras de seguran√ßa do Firebase na Realtime Database?</h3><h4 name="13ae" id="13ae" class="graf graf--h4 graf-after--h3 graf--subtitle">Parte 2‚Ää‚Äî‚ÄäValida√ß√µes e¬†√çndices</h4><p name="f2cc" id="f2cc" class="graf graf--p graf-after--h4">Depois de termos aprendido a definir regras para leitura e escrita de dados na nossa Realtime Database no <a href="https://medium.com/android-dev-moz/45b28cda14ad" data-href="https://medium.com/android-dev-moz/45b28cda14ad" class="markup--anchor markup--p-anchor" target="_blank">artigo anterior,</a> neste artigo vamos aprender como validar esses dados e como definir √≠ndices para ordenar os mesmos.</p><p name="ab6c" id="ab6c" class="graf graf--p graf-after--p">Tal como sabemos, as regras de seguran√ßa s√£o uma √°rvore JSON composta por n√≥s, chaves e valores (tal como qualquer outra √°rvore JSON), e j√° conhecemos 2 das 4 chaves que fazem parte das regras de seguran√ßa: ‚Äú.read‚Äù e ‚Äú.write‚Äù. Por isso, neste artigo vamos olhar para as outras 2 que faltavam: ‚Äú.validate‚Äù e ‚Äú.indexOn‚Äù.</p><h3 name="4e24" id="4e24" class="graf graf--h3 graf-after--p">Valida√ß√£o de dados (.validate)</h3><p name="2da4" id="2da4" class="graf graf--p graf-after--h3">A valida√ß√£o de dados √© importante para garantir que tenhamos uma base de dados consistente.(<a href="https://medium.com/u/5d9117005c71" data-href="https://medium.com/u/5d9117005c71" data-anchor-type="2" data-user-id="5d9117005c71" data-action-value="5d9117005c71" data-action="show-user-card" data-action-type="hover" class="markup--user markup--p-user" target="_blank">Lazaro Anibal</a> que o diga*). Afinal de contas, se a nossa base de dados √© apenas uma √°rvore JSON, n√£o podemos permitir que um mesmo campo tenha o valor de um tipo num n√≥ e outro tipo noutro n√≥ (sendo que ambos fazem parte da mesma lista):</p><pre name="f4c7" id="f4c7" class="graf graf--pre graf--startsWithDoubleQuote graf-after--p">‚Äúutilizadores‚Äù:{<br>    ‚Äúuid1‚Äù:{<br>        ‚Äúnome‚Äù:‚ÄùRos√°rio‚Äù,<br>        ‚Äúvisto‚Äù:‚Äù201802282030&quot;<br>    },<br>    ‚Äúuid2‚Äù:{<br>        ‚Äúnome‚Äù:‚ÄùPaulo‚Äù,<br>        ‚Äúvisto‚Äù:{<br>            ‚Äúdia‚Äù:‚Äù07/03/2017&quot;,<br>            ‚Äúhora‚Äù:‚Äù20h‚Äù<br>        }<br>    }<br>}</pre><p name="05b0" id="05b0" class="graf graf--p graf-after--pre">Nem permitir que na mesma lista exista um n√≥ que tenha um campo (importante) e outro que n√£o tenha:</p><pre name="8170" id="8170" class="graf graf--pre graf-after--p">&quot;utilizadores&quot;:{<br>    &quot;uid1&quot;:{<br>       &quot;nome&quot;:&quot;Ros√°rio&quot;,<br>       &quot;idade&quot;:20,<br>       &quot;email&quot;:&quot;<a href="mailto:rosariofernandes51@gmail.com" data-href="mailto:rosariofernandes51@gmail.com" class="markup--anchor markup--pre-anchor" rel="nofollow" target="_blank">rosariofernandes51@gmail.com</a>&quot;,<br>       &quot;visto&quot;:&quot;201802282030&quot;<br>    },<br>    &quot;uid2&quot;:{<br>       &quot;nome&quot;:&quot;Paulo&quot;,<br>       &quot;idade&quot;:22,<br>       &quot;visto&quot;:&quot;201803072000&quot;<br>    }<br>}</pre><p name="bd10" id="bd10" class="graf graf--p graf-after--pre">√â para evitar as situa√ß√µes mostradas acima que existe a regra ‚Äú.validate‚Äù. Podemos evitar o problema do exemplo 1 utilizando as regras a seguir:</p><pre name="fc86" id="fc86" class="graf graf--pre graf-after--p">&quot;utilizadores&quot;:{<br>    &quot;$uid&quot;:{<br>        &quot;.write&quot;:&quot;auth!=null &amp;&amp; $uid == auth.uid&quot;,<br>        &quot;.read&quot;:&quot;auth!=null &amp;&amp; $uid == auth.uid&quot;,<br>        &quot;.validate&quot;:&quot;newData.child(&#39;visto&#39;).isString()&quot;<br>    }<br>}</pre><p name="58b8" id="58b8" class="graf graf--p graf-after--pre">Neste exemplo, <code class="markup--code markup--p-code">newData.child(‚Äòvisto‚Äô).isString()</code> vai garantir que o atributo <code class="markup--code markup--p-code">visto</code> que seja sempre uma String. Se n√£o for enviado uma String, ent√£o o utilizador n√£o ser√° guardado na database.</p><p name="6b28" id="6b28" class="graf graf--p graf-after--p">E para evitar o problema do exemplo 2, podemos utilizar as regras:</p><pre name="87b0" id="87b0" class="graf graf--pre graf-after--p">&quot;utilizadores&quot;:{<br>    &quot;$uid&quot;:{<br>        &quot;.write&quot;:&quot;auth!=null &amp;&amp; $uid == auth.uid&quot;,<br>        &quot;.read&quot;:&quot;auth!=null &amp;&amp; $uid == auth.uid&quot;, .validate&quot;:&quot;newData.hasChildren([&#39;nome&#39;,&#39;idade&#39;,&#39;visto&#39;,&#39;email&#39;])&quot;<br>    }<br>}</pre><p name="6028" id="6028" class="graf graf--p graf-after--pre">Esta regra obriga que o nosso objeto utilizador tenha os 4 campos(nome, idade, visto e email) para que possa ser armazenado na database.</p><h3 name="5a3a" id="5a3a" class="graf graf--h3 graf-after--p">√çndices (.indexOn)</h3><p name="83f9" id="83f9" class="graf graf--p graf-after--h3">Se voc√™ j√° utilizou o m√©todo <code class="markup--code markup--p-code">orderByChild()</code> quando criava uma Query para ler dados do Firebase, provavelmente j√° se deparou com o aviso(<em class="markup--em markup--p-em">warning</em>):</p><blockquote name="f552" id="f552" class="graf graf--blockquote graf-after--p">Using an unspecified index. Consider adding ‚Äú.indexOn‚Äù¬†‚Ä¶ to your security and Firebase Database rules for better performance</blockquote><p name="086e" id="086e" class="graf graf--p graf-after--blockquote">Isso acontece porque, por padr√£o, o Firebase ordena os dados de acordo com as suas chaves. Se voc√™ quiser ordenar por um outro atributo/child, voc√™ deve especificar qual √© esse atributo/child para que a Realtime Database possa ordenar os dados assim na pr√≥pria base de dados, antes de enviar para a sua aplica√ß√£o (Android, Web ou iOS). Isso porque ordenar os dados na aplica√ß√£o pode ter custos elevados em termos de performance (uso de mem√≥ria e bateria).</p><p name="3589" id="3589" class="graf graf--p graf-after--p">Por exemplo, se quisermos ordenar os nossos utilizadores pelo nome, utilizamos a regra¬†.indexOn com o nome:</p><pre name="962e" id="962e" class="graf graf--pre graf-after--p">&quot;utilizadores&quot;:{<br>    &quot;$uid&quot;:{<br>        &quot;.write&quot;:&quot;auth!=null &amp;&amp; $uid == auth.uid&quot;,<br>        &quot;.read&quot;:&quot;auth!=null &amp;&amp; $uid == auth.uid&quot;,<br>        &quot;.indexOn&quot;:&quot;nome&quot;<br>    }<br>}</pre><p name="7133" id="7133" class="graf graf--p graf-after--pre">Se houver uma outra tela na nossa aplica√ß√£o onde precisamos de ordenar os utilizadores com base em um outro atributo (como o email por exemplo). Podemos especificar isso passando um array para o indexOn:</p><pre name="ae07" id="ae07" class="graf graf--pre graf-after--p">&quot;utilizadores&quot;:{<br>    &quot;$uid&quot;:{<br>        &quot;.write&quot;:&quot;auth!=null &amp;&amp; $uid == auth.uid&quot;,<br>        &quot;.read&quot;:&quot;auth!=null &amp;&amp; $uid == auth.uid&quot;,<br>        &quot;.indexOn&quot;: [&quot;nome&quot;,&quot;email&quot;]<br>    }<br>}</pre><h3 name="3e34" id="3e34" class="graf graf--h3 graf-after--pre">B√≥nus: Regras baseadas em¬†queries</h3><p name="8380" id="8380" class="graf graf--p graf-after--h3">A <a href="https://firebase.google.com/docs/database/security/securing-data?hl=pt-pt#rules_are_not_filters" data-href="https://firebase.google.com/docs/database/security/securing-data?hl=pt-pt#rules_are_not_filters" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">documenta√ß√£o</a> especifica claramente que: <strong class="markup--strong markup--p-strong">‚ÄúRegras n√£o s√£o filtros‚Äù</strong>. O que significa que n√£o tem como criar regras para mostrar apenas um certo grupo de dados e outros n√£o (filtragem b√°sica).</p><p name="43a0" id="43a0" class="graf graf--p graf-after--p">Mas em Janeiro de 2018, <a href="https://firebase.googleblog.com/2018/01/introducing-query-based-security-rules.html" data-href="https://firebase.googleblog.com/2018/01/introducing-query-based-security-rules.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">o Firebase anunciou as regras baseadas em queries</a>. Estas regras servem para limitar os tipos de queries que podem ser executadas na nossa base de dados. E de certa forma, fazem algo parecido com uma filtragem que antes n√£o era poss√≠vel fazer.</p><p name="305f" id="305f" class="graf graf--p graf-after--p">Por exemplo, supondo que temos 2 tipos de utilizadores na database. Queremos permitir que um dos utilizadores possa ler todo o n√≥ mensagens, enquanto o outro s√≥ l√™ as primeiras 25 mensagens marcadas como activas.</p><figure name="27d2" id="27d2" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/rosariopfernandes/d9af6a5c5aca7caf0c5471bfef8771ea.js"></script></figure><p name="3b70" id="3b70" class="graf graf--p graf-after--figure">Para tal, podemos limitar os tipos de queries que podem ser executados nesse n√≥:</p><pre name="c428" id="c428" class="graf graf--pre graf-after--p">{<br> &quot;mensagens&quot;:{<br>  &quot;.read&quot;:&quot;query.orderByKey || (query.orderByChild == &#39;activa&#39; &amp;&amp; query.limitToFirst == 25)&quot;,<br>  &quot;.write&quot;:&quot;auth!=null&quot;<br> }<br>}</pre><p name="c927" id="c927" class="graf graf--p graf-after--pre">Com estas regras, s√≥ podem ser executadas as seguintes queries na database:</p><pre name="e394" id="e394" class="graf graf--pre graf-after--p">getReference(‚Äúmensagens‚Äù).orderByKey(); //e</pre><pre name="8510" id="8510" class="graf graf--pre graf-after--pre">getReference(‚Äúmensagens‚Äù).orderByChild(‚Äúactiva‚Äù).limitToFirst(10);</pre><p name="4c8d" id="4c8d" class="graf graf--p graf-after--pre">Qualquer outra query resultar√° em <code class="markup--code markup--p-code">PERMISSION_DENIED</code>.</p><p name="361b" id="361b" class="graf graf--p graf-after--p graf--trailing">E esta foi a √∫ltima regra que eu tinha para mostrar nesta s√©rie de <strong class="markup--strong markup--p-strong">Regras de Seguran√ßa da Realtime Database</strong>. Agora voc√™ pode manter a sua base de dados segura. No pr√≥ximo artigo explicarei como utilizar o Simulador de Regras da Realtime Database.</p></div></div></section><section name="44e8" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="acab" id="acab" class="graf graf--p graf--leading">Caso tenha alguma d√∫vida ou sugest√£o, pode me contactar pelo email <a href="mailto:rosariofernandes51@gmail.com" data-href="mailto:rosariofernandes51@gmail.com" class="markup--anchor markup--p-anchor" target="_blank">rosariofernandes51@gmail.com</a> ou pelo <a href="https://telegram.me/rosariopfernandes" data-href="https://telegram.me/rosariopfernandes" class="markup--anchor markup--p-anchor" rel="nofollow noopener nofollow noopener nofollow noopener nofollow noopener noopener noopener" target="_blank">Telegram</a>. Ser√° um prazer conversar com voc√™. üôÇ</p><p name="9ff6" id="9ff6" class="graf graf--p graf-after--p graf--trailing">*- <a href="https://medium.com/u/5d9117005c71" data-href="https://medium.com/u/5d9117005c71" data-anchor-type="2" data-user-id="5d9117005c71" data-action-value="5d9117005c71" data-action="show-user-card" data-action-type="hover" class="markup--user markup--p-user" target="_blank">Lazaro Anibal</a> √© um amigo que teve um problema com as regras de validate e inspirou-me a escrever este post. Thanks dude üòÉ</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@thatfire.dev" class="p-author h-card">Ros√°rio Pereira Fernandes</a> on <a href="https://medium.com/p/210ce13117e"><time class="dt-published" datetime="2018-03-08T18:31:00.978Z">March 8, 2018</time></a>.</p><p><a href="https://medium.com/@thatfire.dev/fbs2-210ce13117e" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 24, 2025.</p></footer></article></body></html>