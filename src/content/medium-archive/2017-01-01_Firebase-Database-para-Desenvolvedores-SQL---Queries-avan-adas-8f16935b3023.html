<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Firebase Database para Desenvolvedores SQL‚Ää‚Äî‚ÄäQueries avan√ßadas</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Firebase Database para Desenvolvedores SQL‚Ää‚Äî‚ÄäQueries avan√ßadas</h1>
</header>
<section data-field="subtitle" class="p-summary">
Uma s√©rie para desenvolvedores SQL poderem come√ßar a utilizar o Firebase.
</section>
<section data-field="description" class="p-summary">
Agora que j√° sabemos realizar opera√ß√µes b√°sicas e conhecemos algumas t√©cnicas para ler dados na Firebase Realtime Database, est√° na hora de aprendermos algumas queries mais complexas.
</section>
<section data-field="body" class="e-content">
<section name="8330" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><figure name="1649" id="1649" class="graf graf--figure graf--leading"><img class="graf-image" data-image-id="1*t0XSRkMdq-CXhh8UOgan8Q.png" data-width="1043" data-height="313" src="https://cdn-images-1.medium.com/max/800/1*t0XSRkMdq-CXhh8UOgan8Q.png"></figure><h3 name="fa52" id="fa52" class="graf graf--h3 graf-after--figure graf--title">Firebase Database para Desenvolvedores SQL‚Ää‚Äî‚ÄäQueries avan√ßadas</h3><p name="95bc" id="95bc" class="graf graf--p graf-after--h3 graf--trailing"><strong class="markup--strong markup--p-strong">ATEN√á√ÉO! O FIREBASE TEM AGORA O </strong><a href="https://medium.com/android-dev-moz/firestore-8d225062ffe8" data-href="https://medium.com/android-dev-moz/firestore-8d225062ffe8" class="markup--anchor markup--p-anchor" target="_blank"><strong class="markup--strong markup--p-strong">CLOUD FIRESTORE</strong></a><strong class="markup--strong markup--p-strong"> QUE √â UM SERVI√áO DE BASE DE DADOS MAIS SIMPLES DE ESTRUTURAR. SE VOC√ä ESTIVER A COME√áAR UM PROJECTO, RECOMENDO QUE UTILIZE O </strong><a href="https://medium.com/android-dev-moz/firestore-8d225062ffe8" data-href="https://medium.com/android-dev-moz/firestore-8d225062ffe8" class="markup--anchor markup--p-anchor" target="_blank"><strong class="markup--strong markup--p-strong">FIRESTORE</strong></a><strong class="markup--strong markup--p-strong"> AO INV√âS DA REALTIME DATABASE.</strong></p></div></div></section><section name="dd0f" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="050b" id="050b" class="graf graf--p graf--leading">Agora que j√° sabemos realizar <a href="https://medium.com/p/4ee3d26a3d15/" data-href="https://medium.com/p/4ee3d26a3d15/" class="markup--anchor markup--p-anchor" target="_blank">opera√ß√µes b√°sicas</a> e conhecemos <a href="https://medium.com/p/8bab8efd1e95" data-href="https://medium.com/p/8bab8efd1e95" class="markup--anchor markup--p-anchor" target="_blank">algumas t√©cnicas para ler dados na Firebase Realtime Database</a>, est√° na hora de aprendermos algumas queries mais complexas.</p><p name="d8ed" id="d8ed" class="graf graf--p graf-after--p">Vamos come√ßar por olhar para a d√∫vida que ficou aberta no artigo anterior:</p><h4 name="1750" id="1750" class="graf graf--h4 graf-after--p">Como encontrar todos os usu√°rios com 21 anos e que vivem em¬†Maputo?</h4><p name="072a" id="072a" class="graf graf--p graf-after--h4">No SQL √© simples, basta utilizar a query:</p><pre name="0599" id="0599" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">SELECT</strong> * <strong class="markup--strong markup--pre-strong">FROM</strong> usuarios <strong class="markup--strong markup--pre-strong">WHERE</strong> idade=21 <strong class="markup--strong markup--pre-strong">AND</strong> cidade = &#39;Maputo&#39;;</pre><p name="36b5" id="36b5" class="graf graf--p graf-after--pre">E seguindo a l√≥gica das queries anteriores, no firebase para android, voc√™ provavelmente ir√° querer utilizar o <code class="markup--code markup--p-code u-paddingRight0 u-marginRight0"><em class="markup--em markup--p-em">orderByChild</em>(‚Äòidade‚Äô).<em class="markup--em markup--p-em">equalTo</em>(21)</code> e <code class="markup--code markup--p-code u-paddingRight0 u-marginRight0"><em class="markup--em markup--p-em">orderByChild</em>(‚Äòcidade‚Äô).<em class="markup--em markup--p-em">equalTo</em>(‚ÄòMaputo‚Äô)</code>. Mas infelizmente, o firebase n√£o permite utilizar 2 m√©todos de ordena√ß√£o na mesma Query.</p><p name="aa6d" id="aa6d" class="graf graf--p graf-after--p">Por isso, como alternativa, podemos criar um novo atributo na nossa base de dados para armazenar a idade e a cidade. Vamos chamar-lhe de ‚Äúidade_cidade‚Äù. E fica assim:</p><figure name="86b2" id="86b2" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*I_0foOGodRIQPO3xlKcrpA.png" data-width="399" data-height="417" src="https://cdn-images-1.medium.com/max/800/1*I_0foOGodRIQPO3xlKcrpA.png"></figure><p name="0f45" id="0f45" class="graf graf--p graf-after--figure">Assim, para encontrarmos todos os usu√°rios com 21 anos e que vivem em Maputo, basta utilizar a query:</p><pre name="39ef" id="39ef" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">Query</strong> query1 = raiz.<em class="markup--em markup--pre-em">child</em>(&#39;usuarios&#39;).<em class="markup--em markup--pre-em">orderByChild</em>(&#39;idade_cidade&#39;).<em class="markup--em markup--pre-em">equalTo</em>(&#39;21_maputo&#39;);</pre><p name="742e" id="742e" class="graf graf--p graf-after--pre">√â como eu disse no artigo anterior: Devemos estruturar os nossos dados de acordo com a forma como eles ser√£o dispostos na interface gr√°fica.</p><h4 name="b295" id="b295" class="graf graf--h4 graf-after--p">Encontrar os nomes do estudantes do grupo de id ‚Äúam‚Äù¬†(JOIN)</h4><p name="ce79" id="ce79" class="graf graf--p graf-after--h4">Em SQL, voc√™ provavelmente ia utilizar algo parecido com:</p><pre name="289a" id="289a" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">SELECT</strong> g.nome <strong class="markup--strong markup--pre-strong">AS</strong> NomeGrupo, u.nome <strong class="markup--strong markup--pre-strong">AS</strong> NomeUsuario <strong class="markup--strong markup--pre-strong">FROM</strong> grupos <strong class="markup--strong markup--pre-strong">AS</strong> g <strong class="markup--strong markup--pre-strong">INNER JOIN</strong> estudantes <strong class="markup--strong markup--pre-strong">AS</strong> est <strong class="markup--strong markup--pre-strong">ON</strong> g.id = est.id_grupo <strong class="markup--strong markup--pre-strong">INNER JOIN</strong> usuarios <strong class="markup--strong markup--pre-strong">AS</strong> u <strong class="markup--strong markup--pre-strong">ON</strong> u.id = est.id_estudante <strong class="markup--strong markup--pre-strong">WHERE</strong> g.id = &quot;am&quot;; //Encontrar todos os participantes do grupo com ID &quot;am&quot; (Analise Matematica)</pre><p name="f4e1" id="f4e1" class="graf graf--p graf-after--pre">No Firebase n√£o existe nenhum m√©todo espec√≠fico para fazer JOIN, mas isso n√£o significa que voc√™ n√£o pode obter dados de 2 n√≥s diferentes e junt√°-los.</p><p name="d5b3" id="d5b3" class="graf graf--p graf-after--p">Para ter o nome dos estudantes do grupo ‚Äúam‚Äù, basta utilizarmos a query:</p><pre name="c1fb" id="c1fb" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">Query</strong> query2 = raiz.<em class="markup--em markup--pre-em">child</em>(&quot;estudantes/am&quot;);<br>//E colocamos um listener<br>query2.<em class="markup--em markup--pre-em">addChildEventListener</em>(new <strong class="markup--strong markup--pre-strong">ChildEventListener</strong>() {<br>    @Override<br>    public void <em class="markup--em markup--pre-em">onChildAdded</em>(<strong class="markup--strong markup--pre-strong">DataSnapshot</strong> dataSnapshot, <strong class="markup--strong markup--pre-strong">String</strong> s) {<br>        //colocar os nomes na interface grafica<br>    }<br>    @Override<br>    public void <em class="markup--em markup--pre-em">onChildChanged</em>(<strong class="markup--strong markup--pre-strong">DataSnapshot</strong> dataSnapshot, <strong class="markup--strong markup--pre-strong">String</strong> s) {}<br>    @Override<br>    public void <em class="markup--em markup--pre-em">onChildRemoved</em>(<strong class="markup--strong markup--pre-strong">DataSnapshot</strong> dataSnapshot) {}<br>    @Override<br>    public void <em class="markup--em markup--pre-em">onChildMoved</em>(<strong class="markup--strong markup--pre-strong">DataSnapshot</strong> dataSnapshot, <strong class="markup--strong markup--pre-strong">String</strong> s) {}<br>    @Override<br>    public void <em class="markup--em markup--pre-em">onCancelled</em>(<strong class="markup--strong markup--pre-strong">DatabaseError</strong> databaseError) {}<br>});</pre><p name="d7f4" id="d7f4" class="graf graf--p graf-after--pre">Repare que aqui n√≥s utilizamos o ChildEventListener. Porque voc√™ provavelmente n√£o vai precisar de manter os nomes sincronizados em tempo real, mas sim, actualizar a lista de participantes quando algu√©m entrar no grupo.</p><p name="46a3" id="46a3" class="graf graf--p graf-after--p">Mas desta forma, obtemos apenas os nomes dos estudantes, e n√£o temos todos os dados deles. Para obter os outros dados, podemos criar uma referencia dentro desta query, j√° que temos o id do usu√°rio.</p><pre name="e0da" id="e0da" class="graf graf--pre graf-after--p">@Override<br>    public void <em class="markup--em markup--pre-em">onChildAdded</em>(<strong class="markup--strong markup--pre-strong">DataSnapshot</strong> dataSnapshot, <strong class="markup--strong markup--pre-strong">String</strong> s) {<br>        <strong class="markup--strong markup--pre-strong">DatabaseReference</strong> usuario = raiz.<em class="markup--em markup--pre-em">child</em>(&quot;usuarios/&quot;+dataSnapshot.<em class="markup--em markup--pre-em">getKey</em>());<br>        usuario.<em class="markup--em markup--pre-em">addListenerForSingleValueEvent</em>(new <strong class="markup--strong markup--pre-strong">ValueEventListener</strong>() {<br>    @Override<br>    public void <em class="markup--em markup--pre-em">onDataChange</em>(<strong class="markup--strong markup--pre-strong">DataSnapshot</strong> dataSnapshot) { <br>        //Obter os outros dados do usuario</pre><pre name="0ca3" id="0ca3" class="graf graf--pre graf-after--pre">    }<br><br>    @Override<br>    public void <em class="markup--em markup--pre-em">onCancelled</em>(<strong class="markup--strong markup--pre-strong">DatabaseError</strong> databaseError) {<br><br>    }<br>});</pre><pre name="f35d" id="f35d" class="graf graf--pre graf-after--pre">    }</pre><p name="7170" id="7170" class="graf graf--p graf-after--pre">Como deu para notar, n√£o existe uma forma ‚Äúpadr√£o‚Äù de estruturar bases de dados NoSQL. Ela pode variar de acordo com a aplica√ß√£o que se est√° a desenvolver.</p><p name="495e" id="495e" class="graf graf--p graf-after--p graf--trailing">No <a href="https://medium.com/p/39c882550f11" data-href="https://medium.com/p/39c882550f11" class="markup--anchor markup--p-anchor" target="_blank">pr√≥ximo artigo</a>, explico como usar a Denormaliza√ß√£o para simplificar e reduzir queries.</p></div></div></section><section name="51e0" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="636d" id="636d" class="graf graf--p graf--leading graf--trailing">Caso tenha alguma d√∫vida ou sugest√£o, deixe abaixo nos coment√°rios. Se voc√™ estiver tentando usar a Realtime Database e teve um problema, <a href="https://pt.stackoverflow.com/questions/ask?tags=firebase" data-href="https://pt.stackoverflow.com/questions/ask?tags=firebase" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">coloque ele no StackOverflow</a>, explicando o que voc√™ fez e qual foi o erro que teve. De certeza que voc√™ obter√° ajuda de mim ou de algu√©m da comunidade. üôÇ</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@thatfire.dev" class="p-author h-card">Ros√°rio Pereira Fernandes</a> on <a href="https://medium.com/p/8f16935b3023"><time class="dt-published" datetime="2017-01-01T16:02:00.843Z">January 1, 2017</time></a>.</p><p><a href="https://medium.com/@thatfire.dev/firebasesql-8f16935b3023" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 24, 2025.</p></footer></article></body></html>