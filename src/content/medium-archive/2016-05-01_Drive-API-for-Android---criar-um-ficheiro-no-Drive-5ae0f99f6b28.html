<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Drive API for Android — criar um ficheiro no Drive</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Drive API for Android — criar um ficheiro no Drive</h1>
</header>
<section data-field="subtitle" class="p-summary">
Hoje em dia, muitas pessoas usam serviços de armazenamento em nuvem para vários fins: professional, académico e até pessoal. Através destes…
</section>
<section data-field="body" class="e-content">
<section name="6181" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="3f35" id="3f35" class="graf graf--h3 graf--leading graf--title">Drive API for Android — criar um ficheiro no Drive</h3><p name="951d" id="951d" class="graf graf--p graf-after--h3">Hoje em dia, muitas pessoas usam serviços de armazenamento em nuvem para vários fins: professional, académico e até pessoal. Através destes serviços é possível compartilhar ficheiros com bastante facilidade. A Google também tem o seu sistema de armazenamento em nuvem: O <a href="http://www.google.com/intl/pt-BR/drive/" data-href="http://www.google.com/intl/pt-BR/drive/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Google Drive</a>.</p><p name="b2d8" id="b2d8" class="graf graf--p graf-after--p">Como a maior parte dos serviços da Google, o Drive também tem uma API para usarmos quando desenvolvemos aplicações para várias plataformas, a <a href="https://developers.google.com/drive/" data-href="https://developers.google.com/drive/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Drive API</a>. A Drive API permite que a nossa aplicação possa aceder ao Drive de um usuário (desde que este permita, claro) e manipule os seus ficheiros e pastas.</p><p name="6eb4" id="6eb4" class="graf graf--p graf-after--p">Recentemente, foi lançada a <a href="https://developers.google.com/drive/android/" data-href="https://developers.google.com/drive/android/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Drive Android API</a> (você pode ver o <a href="https://www.youtube.com/watch?v=quQyZdhPjxc" data-href="https://www.youtube.com/watch?v=quQyZdhPjxc" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">vídeo de lançamento aqui</a>), que traz algumas funcionalidades da Drive API para o seu uso nativo no Android.</p><h3 name="c453" id="c453" class="graf graf--h3 graf-after--p">O que me levou a usar a Drive API?</h3><p name="c766" id="c766" class="graf graf--p graf-after--h3">Bom, recorri à Drive API porque precisava de armazenar um ficheiro de texto (.txt) em algum lugar seguro, de forma que fosse partilhado apenas entre a aplicação e o usuário (permitindo que este manipule à vontade o ficheiro). O ficheiro é gerado pela minha aplicação <a href="http://rpfsoftwares.site90.net/rap/" data-href="http://rpfsoftwares.site90.net/rap/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Roll a Pass</a>, e contém palavras-passe do usuário da aplicação que são armazenadas localmente na base de dados local da aplicação.</p><p name="0b11" id="0b11" class="graf graf--p graf-after--p">Uma grande vantagem que encontrei na Drive API foi o facto de não haver necessidade de obter a permissão para aceder à Internet. Isto garante que os usuários tenham mais confiança ao armazenar os seus dados na aplicação, sabendo que não correrão o risco de ter as suas palavras-passe <em class="markup--em markup--p-em">vazadas</em> na Internet.</p><p name="173a" id="173a" class="graf graf--p graf-after--p">Neste post, vou mostrar-vos como foi implementada a Drive API na aplicação e como ela é usada para criar ficheiros na <em class="markup--em markup--p-em">pasta raíz</em> do Drive do usuário.</p><p name="2b9c" id="2b9c" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">1.</strong> <strong class="markup--strong markup--p-strong">Fazer o download do Google Play Services SDK</strong></p><p name="ed6c" id="ed6c" class="graf graf--p graf-after--p">Primeiramente, tenha certeza que você possui o <a href="https://developers.google.com/android/guides/overview" data-href="https://developers.google.com/android/guides/overview" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Google Play Services SDK</a>, que inclui a Google Drive Android API. Para obter este SDK, basta entrar no <a href="http://developer.android.com/tools/help/sdk-manager.html" data-href="http://developer.android.com/tools/help/sdk-manager.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Gerenciador de SDK do Android</a> e descarregar a última versão (8.4.0 na data de publicação deste post).</p><p name="4123" id="4123" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">2.</strong> <strong class="markup--strong markup--p-strong">Registar a sua aplicação na Consola de Desenvolvedores Google e obter um certificado de autorização</strong></p><p name="50cc" id="50cc" class="graf graf--p graf-after--p">Se você ainda não registou a sua aplicação na Google Developers Console, <a href="https://console.developers.google.com//start/api?id=drive&amp;credential=client_key" data-href="https://console.developers.google.com//start/api?id=drive&amp;credential=client_key" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">clique aqui para criar um projecto na Consola de Desenvolvedores</a>. Basta preencher os campos com o nome da aplicação (App Name) e o nome do pacote da aplicação (conforme está no AndroidManifest.xml da sua aplicação).</p><p name="769d" id="769d" class="graf graf--p graf-after--p">Depois de criar o projecto na Consola e activar a Drive API, você precisa obter o certificado de autorização. Para fazer isto, você tem de usar a ferramenta <a href="http://docs.oracle.com/javase/6/docs/technotes/tools/windows/keytool.html" data-href="http://docs.oracle.com/javase/6/docs/technotes/tools/windows/keytool.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Keytool</a> para poder obter o certificado SHA1 que é gerado pela chave utilizada para certificar a aplicação (keystore).</p><p name="1194" id="1194" class="graf graf--p graf-after--p">Se a aplicação ainda está em fase de testes, a keystore encontra-se na pasta <em class="markup--em markup--p-em">.android</em> com o nome <em class="markup--em markup--p-em">android-debug.keystore</em> (palavra-passe: android )e caso esteja para fazer o <em class="markup--em markup--p-em">release</em> da aplicação, ou actualizar uma cujo o release já foi efectuado, utilize o ficheiro <em class="markup--em markup--p-em">*.keystore</em> que só você sabe onde se encontra e qual a palavra-passe. Para obter o certificado SHA1, use o comando: <em class="markup--em markup--p-em">keytool –list –v –keystore keysore.jks</em> onde “<em class="markup--em markup--p-em">keystore.jks</em>” é o caminho para o seu ficheiro keystore. Copie o certificado SHA1 (20 pares de 2 caracteres hexadecimais separados por “:”) para criar as credencias na consola.</p><p name="285b" id="285b" class="graf graf--p graf-after--p">Vá para a <a href="https://console.developers.google.com/apis/credentials?project=" data-href="https://console.developers.google.com/apis/credentials?project=" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">página de credenciais</a> da sua aplicação e clique em <em class="markup--em markup--p-em">Adicionar Credenciais &gt; OAuth 2.0 client ID</em> e escolha <em class="markup--em markup--p-em">Android</em>. No campo <em class="markup--em markup--p-em">Package Name</em>, introduza o nome do Pacote conforme está no <em class="markup--em markup--p-em">AndroidManifest.xml</em> da sua aplicação e cole o certificado SHA1 quando for requisitado.</p><p name="6ed2" id="6ed2" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">3.</strong> <strong class="markup--strong markup--p-strong">Adicionar a dependência do Google Play Services</strong></p><p name="9aec" id="9aec" class="graf graf--p graf-after--p">Se você ainda não colocou a dependência do Google Play Services no seu projecto, pode fazê-lo adicionando-o ao ficheiro<em class="markup--em markup--p-em"> build.gradle (Module:app)</em>. Para usar o Google Play Services, geralmente, coloca-se a linha: <em class="markup--em markup--p-em">compile ‘com.google.android.gms:play-services:8.4.0’</em>; mas desde a versão 6 deste SDK, é possível especificar qual o serviço que pretendemos utilizar, para não importar todos os serviços Play (que são muitos). Assim, na minha aplicação usei apenas: <em class="markup--em markup--p-em">compile ‘com.google.android.gms:play-services-drive:8.4.0’</em> porque só vou usar a Drive API.</p><p name="8750" id="8750" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">4.</strong> <strong class="markup--strong markup--p-strong">Conectar e Autorizar a Google Drive Android API</strong></p><p name="0e35" id="0e35" class="graf graf--p graf-after--p">A autorização para o Google Drive Android API é garantida pela classe <a href="https://developers.google.com/android/reference/com/google/android/gms/common/api/GoogleApiClient" data-href="https://developers.google.com/android/reference/com/google/android/gms/common/api/GoogleApiClient" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">GoogleApiClient</a>. Esta é geralmente criada no método <em class="markup--em markup--p-em">onCreate()</em> de uma Activity que implementa as interfaces <em class="markup--em markup--p-em">ConnectionCallbacks</em> e <em class="markup--em markup--p-em">OnConnectionFailedListener</em>.</p><pre name="7987" id="7987" class="graf graf--pre graf-after--p">@Override<br> public void onCreate(Bundle savedInstanceState) {<br> super.onCreate(savedInstance);<br> <br> mGoogleApiClient = new GoogleApiClient.Builder(this)<br> .addApi(Drive.API)<br> .addScope(Drive.SCOPE_FILE)<br> .addConnectionCallbacks(this)<br> .addOnConnectionFailedListener(this)<br> .build();<br> }</pre><p name="9665" id="9665" class="graf graf--p graf-after--pre">Depois de criar o cliente, é necessário chamar o método <em class="markup--em markup--p-em">connect()</em> para ocorrer a autorização. <em class="markup--em markup--p-em">mGoogleApiClient.connect();</em></p><p name="c68e" id="c68e" class="graf graf--p graf-after--p">Se o usuário não autorizou a aplicação, o CallBack <em class="markup--em markup--p-em">onConnectionFailed()</em> será invocado. Será pedido ao usuário para autorizar a aplicação à acessar o Drive.</p><pre name="3aaf" id="3aaf" class="graf graf--pre graf-after--p">@Override</pre><pre name="d289" id="d289" class="graf graf--pre graf-after--pre">public void onConnectionFailed(ConnectionResult connectionResult) {</pre><pre name="6e3b" id="6e3b" class="graf graf--pre graf-after--pre">    if (connectionResult.hasResolution()) {</pre><pre name="bc04" id="bc04" class="graf graf--pre graf-after--pre">        try {</pre><pre name="2ec2" id="2ec2" class="graf graf--pre graf-after--pre">            connectionResult.startResolutionForResult(this, <em class="markup--em markup--pre-em">RESOLVE_CONNECTION_REQUEST_CODE</em>);</pre><pre name="7a4a" id="7a4a" class="graf graf--pre graf-after--pre">        } catch (IntentSender.SendIntentException e) {</pre><pre name="1f0b" id="1f0b" class="graf graf--pre graf-after--pre">            // Não é possível obter a autorização</pre><pre name="6a09" id="6a09" class="graf graf--pre graf-after--pre">        }</pre><pre name="ffe9" id="ffe9" class="graf graf--pre graf-after--pre">    } else {</pre><pre name="3081" id="3081" class="graf graf--pre graf-after--pre">        GoogleApiAvailability.<em class="markup--em markup--pre-em">getInstance</em>().getErrorDialog(this, connectionResult.getErrorCode(), 0).show();</pre><pre name="ed4c" id="ed4c" class="graf graf--pre graf-after--pre">    }</pre><pre name="5a6b" id="5a6b" class="graf graf--pre graf-after--pre">}</pre><p name="4d46" id="4d46" class="graf graf--p graf-after--pre">Depois do usuário completar a autorização, será chamado o método <em class="markup--em markup--p-em">onActivityResult()</em> da aplicação. Se o resultado for <em class="markup--em markup--p-em">RESULT_OK</em>, você deve voltar a chamar o método <em class="markup--em markup--p-em">connect()</em> para restabelecer a ligação.</p><pre name="54ea" id="54ea" class="graf graf--pre graf-after--p">@Override</pre><pre name="6baa" id="6baa" class="graf graf--pre graf-after--pre">protected void onActivityResult(final int requestCode, final int resultCode, final Intent data) {</pre><pre name="52f3" id="52f3" class="graf graf--pre graf-after--pre">    switch (requestCode) {</pre><pre name="f6ef" id="f6ef" class="graf graf--pre graf-after--pre">        case RESOLVE_CONNECTION_REQUEST_CODE:</pre><pre name="11cf" id="11cf" class="graf graf--pre graf-after--pre">            if (resultCode == RESULT_OK) {</pre><pre name="7125" id="7125" class="graf graf--pre graf-after--pre">                mGoogleApiClient.connect();</pre><pre name="4346" id="4346" class="graf graf--pre graf-after--pre">            }</pre><pre name="1af0" id="1af0" class="graf graf--pre graf-after--pre">            break;</pre><pre name="5da0" id="5da0" class="graf graf--pre graf-after--pre">    }</pre><pre name="e678" id="e678" class="graf graf--pre graf-after--pre">}</pre><p name="16cb" id="16cb" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">5.</strong> <strong class="markup--strong markup--p-strong">Criar um ficheiro na pasta raíz do Drive</strong></p><p name="65fa" id="65fa" class="graf graf--p graf-after--p">Existem 2 formas de criar ficheiros com a Drive Android API: usando a classe <em class="markup--em markup--p-em">CreateFileActivityBuilder</em> ou usando o método <em class="markup--em markup--p-em">createFile()</em> da interface <em class="markup--em markup--p-em">DriveFolder</em>.</p><p name="b417" id="b417" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Qual a diferença entre os dois?</strong></p><p name="38b9" id="38b9" class="graf graf--p graf-after--p">O resultado é o mesmo. A diferença está no local onde o usuário irá introduzir o nome do ficheiro. A classe <em class="markup--em markup--p-em">CreateFileActivityBuilder</em> simplifica o processo, oferecendo-nos uma interface pré-criada enquanto que o método <em class="markup--em markup--p-em">createFile()</em> permite que o usuário adicione mais meta-dados.</p><p name="3953" id="3953" class="graf graf--p graf-after--p">Utilizei o método <em class="markup--em markup--p-em">createFile()</em> na minha aplicação, mas você pode ver a implementação da classe <em class="markup--em markup--p-em">CreateFileActivityBuilder</em> <a href="https://developers.google.com/drive/android/create-file#creating_files_programmatically" data-href="https://developers.google.com/drive/android/create-file#creating_files_programmatically" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">aqui</a>.</p><p name="556a" id="556a" class="graf graf--p graf-after--p">Aqui vai o código que usei para gerar o ficheiro na minha aplicação:</p><pre name="8da0" id="8da0" class="graf graf--pre graf-after--p">ResultCallback&lt;DriveApi.DriveContentsResult&gt; contentsCallback = new<br> ResultCallback&lt;DriveApi.DriveContentsResult&gt;() {<br> @Override<br> public void onResult(DriveApi.DriveContentsResult result) {<br> if (!result.getStatus().isSuccess()) {<br> //Não foi possível conectar ao drive<br> return;<br> }<br> final DriveContents driveContents=result.getDriveContents();</pre><pre name="a3f4" id="a3f4" class="graf graf--pre graf-after--pre">//Executar a acção em um Thread separado do Main Thread<br> new Thread() {<br> @Override<br> public void run()<br> {<br> OutputStream outputStream = driveContents.getOutputStream();<br> Writer writer = new OutputStreamWriter(outputStream);<br> try<br> {<br> writer.write(&quot;Olá! https://medium.com/@rosariopfernandes&quot;);<br> writer.flush();<br> writer.close();<br> }<br> catch(IOException e)<br> {<br> Log.e(“Couldn’t Export”,e.getMessage());<br> }</pre><pre name="56a2" id="56a2" class="graf graf--pre graf-after--pre">MetadataChangeSet metadataChangeSet = new MetadataChangeSet.Builder()<br> .setTitle(“Novo ficheiro”) //Nome do ficheiro<br> .setViewed(false)<br> .setMimeType(“text/plain”)<br> .build();</pre><pre name="f407" id="f407" class="graf graf--pre graf-after--pre">//chamada do método createFile<br> Drive.DriveApi.getRootFolder(mGoogleApiClient)<br> .createFile(mGoogleApiClient, metadataChangeSet, driveContents)<br> .setResultCallback(fileCallback);<br> }<br> }.start();<br> }<br> };</pre><pre name="fe7c" id="fe7c" class="graf graf--pre graf-after--pre">final ResultCallback&lt;DriveFolder.DriveFileResult&gt; fileCallback = new<br> ResultCallback&lt;DriveFolder.DriveFileResult&gt;() {<br> @Override<br> public void onResult(DriveFolder.DriveFileResult result) {<br> if (!result.getStatus().isSuccess())<br> {<br>//nao foi possivel criar ficheiro</pre><pre name="53a7" id="53a7" class="graf graf--pre graf-after--pre"> return;<br> }<br> //ficheiro criado com sucesso<br> }<br> };</pre><p name="7484" id="7484" class="graf graf--p graf-after--pre">Além de criar ficheiros, a API conta com mais funcionalidades bastante interessantes como procurar, apagar e transferir ficheiros e pastas, usar notificações para ter o controle de um ficheiro/pasta, entres outras.</p><p name="9fa8" id="9fa8" class="graf graf--p graf-after--p">Espero que este post tenha sido productivo para você. Qualquer dúvida ou sugestão, deixe nos comentários ou mande um email para <a href="mailto:rosariofernandes51@gmail.com" data-href="mailto:rosariofernandes51@gmail.com" class="markup--anchor markup--p-anchor" target="_blank">rosariofernandes51@gmail.com</a> .</p><p name="fc54" id="fc54" class="graf graf--p graf-after--p">Até ao próximo post.</p><p name="d544" id="d544" class="graf graf--p graf-after--p graf--trailing">Rosário Pereira Fernandes</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@thatfire.dev" class="p-author h-card">Rosário Pereira Fernandes</a> on <a href="https://medium.com/p/5ae0f99f6b28"><time class="dt-published" datetime="2016-05-01T05:01:01.396Z">May 1, 2016</time></a>.</p><p><a href="https://medium.com/@thatfire.dev/drive-api-for-android-criar-um-ficheiro-no-drive-5ae0f99f6b28" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 24, 2025.</p></footer></article></body></html>