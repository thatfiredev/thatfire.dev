<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>#SmallerAPK — 5 dicas para reduzir o tamanho do apk</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">#SmallerAPK — 5 dicas para reduzir o tamanho do apk</h1>
</header>
<section data-field="subtitle" class="p-summary">
Olá pessoal, estive a ler uma série de artigos do Wojtek Kalicinski, desenvolvedor Android, que falava sobre a redução do tamanho do APK…
</section>
<section data-field="body" class="e-content">
<section name="e3ff" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="0769" id="0769" class="graf graf--h3 graf--leading graf--title">#SmallerAPK — 5 dicas para reduzir o tamanho do apk</h3><figure name="876b" id="876b" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*cfBe20A3a8gya3ClslUvkw.png" data-width="800" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*cfBe20A3a8gya3ClslUvkw.png"></figure><p name="579c" id="579c" class="graf graf--p graf-after--figure">Olá pessoal, estive a ler uma série de artigos do <a href="https://medium.com/@wkalicinski" data-href="https://medium.com/@wkalicinski" class="markup--anchor markup--p-anchor" target="_blank">Wojtek Kalicinski</a>, desenvolvedor Android, que falava sobre a redução do tamanho do APK. Com as dicas que ele deixou, consegui reduzir consideravelmente o tamanho da minha aplicação, e por isso, decidi escrever este artigo para vos incentivar a procurar sempre reduzir o tamanho do apk.</p><h3 name="7804" id="7804" class="graf graf--h3 graf-after--p">Porque reduzir o espaço do apk?</h3><p name="d50d" id="d50d" class="graf graf--p graf-after--h3">Quando desenvolvemos uma aplicação móvel, temos de ter em conta que existem vários tipos de dispositivos móveis, mas nem todos têm as mesmas capacidades. Alguns dispositivos podem não dispor de memória suficiente para permitir que usuários instalem a aplicação.</p><p name="61cf" id="61cf" class="graf graf--p graf-after--p">Outro factor a ser considerado é que em alguns países há difícil acesso à Internet e em alguns os usuários pagam for cada megabyte gasto em download e não é fácil de encontrar hotspots grátis.</p><p name="675b" id="675b" class="graf graf--p graf-after--p">Por isso, devemos procurar sempre reduzir o tamanho do apk. Aqui estão 5 dicas para fazer isso.</p><h3 name="7a1d" id="7a1d" class="graf graf--h3 graf-after--p">1. Redução do código Dex (Minify)</h3><p name="e22b" id="e22b" class="graf graf--p graf-after--h3">O Android Studio conta com um reductor de código que remove classes e não utilizadas, e renomea algumas variáveis para que tenham nomes mais curtos resultando em um apk menor. Para utilizar esta funcionalidade, basta definir <em class="markup--em markup--p-em">minifyEnabled true</em>, alterando a seguinte parte do ficheiro <em class="markup--em markup--p-em">build.gradle</em> do seu projecto:</p><pre name="ef22" id="ef22" class="graf graf--pre graf-after--p">android {<br> …<br> buildTypes {<br>     release {<br>         <strong class="markup--strong markup--pre-strong">minifyEnabled true</strong><br>            proguardFiles getDefaultProguardFile(‘proguard-android.txt’), ‘proguard-rules.pro’<br>             }<br>            }<br> }</pre><p name="c892" id="c892" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">Atenção!</strong> Infelizmente, em alguns casos, depois de activar o minify, a sua aplicação pode não compilar ou parar durante a execução lançando a <em class="markup--em markup--p-em">ClassNotFoundException</em> por conta de classes que foram removidas pelo reductor de código. Para dar a volta por cima, você tem que criar um ficheiro chamado <em class="markup--em markup--p-em">proguard-rules.pro</em> na sua pasta <em class="markup--em markup--p-em">app/</em> e colocar lá as regras necessárias para que o reductor não remova certas classes e/ou variáveis.</p><p name="4ccd" id="4ccd" class="graf graf--p graf-after--p">Um caso bastante comum é quando definimos uma classe como atributo String num layout XML, como num <em class="markup--em markup--p-em">RecyclerView</em> por exemplo:</p><pre name="cc8e" id="cc8e" class="graf graf--pre graf-after--p">&lt;android.support.v7.widget.RecyclerView</pre><pre name="7eba" id="7eba" class="graf graf--pre graf-after--pre">    app:layoutManager=”android.support.v7.widget.GridLayoutManager”</pre><pre name="ab0f" id="ab0f" class="graf graf--pre graf-after--pre">    ...</pre><pre name="6dbf" id="6dbf" class="graf graf--pre graf-after--pre">/&gt;</pre><p name="f683" id="f683" class="graf graf--p graf-after--pre">Neste caso, o reductor não saberá que a classe <em class="markup--em markup--p-em">GridLayoutManager</em> foi utilizada, por isso será removida. Para corrigir isto, você tem que colocar a seguinte linha no seu ficheiro <em class="markup--em markup--p-em">proguard-rules.pro</em>:</p><pre name="5add" id="5add" class="graf graf--pre graf-after--p">-keep public class android.support.v7.widget.GridLayoutManager {</pre><pre name="ed8c" id="ed8c" class="graf graf--pre graf-after--pre">    public protected *;</pre><pre name="fbe8" id="fbe8" class="graf graf--pre graf-after--pre">}</pre><p name="cec2" id="cec2" class="graf graf--p graf-after--pre">É <strong class="markup--strong markup--p-strong">importante</strong> que você <strong class="markup--strong markup--p-strong">teste a sua aplicação</strong> <strong class="markup--strong markup--p-strong">ao mínimo detalhe</strong>. O facto da aplicação abrir sem nenhum problema não é uma indicação de que o reductor não removeu nenhuma classe necessária. Você deve testar todas as telas e todas as possibilidades de uso da sua aplicação.</p><h3 name="6485" id="6485" class="graf graf--h3 graf-after--p">2. Não importar todos os Google Play Services</h3><p name="624b" id="624b" class="graf graf--p graf-after--h3">Algumas vezes, precisamos de usar bibliotecas do Google Play Services na nossa aplicação. De certeza que não serão usadas todas as API’s, por isso evite importar todo o pacote quando vai usar apenas algumas API’s como Ads, Analytics, Maps, etc. Existe uma <a href="https://developers.google.com/android/guides/setup" data-href="https://developers.google.com/android/guides/setup" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">tabela</a> que especifica como colocar cada dependência que necessitar do Google Play Services. Por exemplo, se você quiser utilizar apenas a API do Google Drive, não precisa de importar toda a Play Services, apenas a Drive API, e para isso, no ficheiro <em class="markup--em markup--p-em">build.gradle</em> do projecto, substitua a linha:</p><pre name="1325" id="1325" class="graf graf--pre graf-after--p"><em class="markup--em markup--pre-em">compile ‘com.google.android.gms:play-services:8.4.0’</em></pre><p name="5013" id="5013" class="graf graf--p graf-after--pre">por:</p><pre name="1907" id="1907" class="graf graf--pre graf-after--p"><em class="markup--em markup--pre-em">compile ‘com.google.android.gms:play-services-drive:8.4.0’</em></pre><h3 name="22da" id="22da" class="graf graf--h3 graf-after--pre">3. Remoção de recursos não usados</h3><p name="7a7d" id="7a7d" class="graf graf--p graf-after--h3">Além de remover código não usado, é possível remover também recursos (layouts, drawables, entre outros ficheiros xml) que não estejam a ser usados pela aplicação. Para fazer isso, basta colocar esta linha no <em class="markup--em markup--p-em">build.gradle </em>do seu projecto:</p><pre name="e259" id="e259" class="graf graf--pre graf-after--p">android {</pre><pre name="5ad2" id="5ad2" class="graf graf--pre graf-after--pre">    ...</pre><pre name="f23a" id="f23a" class="graf graf--pre graf-after--pre">    buildTypes {</pre><pre name="eeed" id="eeed" class="graf graf--pre graf-after--pre">        release {</pre><pre name="5fbc" id="5fbc" class="graf graf--pre graf-after--pre">            minifyEnabled true</pre><pre name="58f2" id="58f2" class="graf graf--pre graf-after--pre">            <strong class="markup--strong markup--pre-strong">shrinkResources true</strong></pre><pre name="bee5" id="bee5" class="graf graf--pre graf-after--pre"><strong class="markup--strong markup--pre-strong">            </strong>proguardFiles getDefaultProguardFile(&#39;proguard-android.txt&#39;), &#39;proguard-rules.pro&#39;</pre><pre name="1be0" id="1be0" class="graf graf--pre graf-after--pre">        }</pre><pre name="5a15" id="5a15" class="graf graf--pre graf-after--pre">    }</pre><pre name="5f68" id="5f68" class="graf graf--pre graf-after--pre">}</pre><p name="16f9" id="16f9" class="graf graf--p graf-after--pre">Assim como o reductor de código, o reductor de recursos também pode remover recursos que você irá precisar. Para manter estes recursos, você pode usar o atributo <em class="markup--em markup--p-em">tools:keep</em> em qualquer tag <em class="markup--em markup--p-em">&lt;resources&gt;</em> da sua aplicação. Por exemplo<a href="#_msocom_1" data-href="#_msocom_1" class="markup--anchor markup--p-anchor">[RPF1]</a> :</p><pre name="368d" id="368d" class="graf graf--pre graf-after--p">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</pre><pre name="6b36" id="6b36" class="graf graf--pre graf-after--pre">&lt;resources xmlns:tools=&quot;http://schemas.android.com/tools&quot;</pre><pre name="d428" id="d428" class="graf graf--pre graf-after--pre">   tools:keep=&quot;@layout/l_used*_c,@layout/l_used_a,@layout/l_used_b*&quot;</pre><pre name="6d96" id="6d96" class="graf graf--pre graf-after--pre">/&gt;</pre><h3 name="4fc9" id="4fc9" class="graf graf--h3 graf-after--pre">4. Remoção de configurações não usadas</h3><p name="8561" id="8561" class="graf graf--p graf-after--h3">Várias bibliotecas contam com recursos <em class="markup--em markup--p-em">String</em> traduzidos em vários idiomas, como por exemplo a Support Library e Google Play Services. Você pode até ter traduções em que começou a trabalhar para a sua aplicação, mas esta ainda não está pronta para ir para esses mercados. Você pode usar a opção <em class="markup--em markup--p-em">resConfigs</em> para restringir as configurações que devem ser incluídas no ficheiro APK final.</p><p name="43ae" id="43ae" class="graf graf--p graf-after--p">Por exemplo:</p><pre name="3464" id="3464" class="graf graf--pre graf-after--p">android {</pre><pre name="56c9" id="56c9" class="graf graf--pre graf-after--pre">    defaultConfig {</pre><pre name="d630" id="d630" class="graf graf--pre graf-after--pre">        ...</pre><pre name="6980" id="6980" class="graf graf--pre graf-after--pre">        resConfigs &quot;en&quot;, &quot;pt&quot;</pre><pre name="65a6" id="65a6" class="graf graf--pre graf-after--pre">    }</pre><pre name="4373" id="4373" class="graf graf--pre graf-after--pre">}</pre><p name="7100" id="7100" class="graf graf--p graf-after--pre">Este código irá remover qualquer recurso que não estiver relacionado com estes 2 idiomas.</p><h3 name="2109" id="2109" class="graf graf--h3 graf-after--p">5. Remoção de “buracos” na alocação de recursos</h3><p name="2325" id="2325" class="graf graf--p graf-after--h3">Este problema não é muito comum em pequenas aplicações, mas ajuda muito na redução do apk de aplicações grandes que tenham centenas ou milhares de strings, styles, etc.</p><p name="d76b" id="d76b" class="graf graf--p graf-after--p">Todas as strings que definimos ficam guardadas num ficheiro <em class="markup--em markup--p-em">resources.arsc</em> dentro da apk criada, e cada string ocupa 4 bytes.</p><p name="e46f" id="e46f" class="graf graf--p graf-after--p">Imaginemos que temos 5 strings no nosso ficheiro <em class="markup--em markup--p-em">values/strings.xml</em>.</p><p name="e63f" id="e63f" class="graf graf--p graf-after--p">Supondo que vamos adicionar uma funcionalidade que estará presente apenas em dispositivos com API 21 ou superior e esta funcionalidade precisa de mostrar uma mensagem diferente do que a normal, então criamos o ficheiro <em class="markup--em markup--p-em">values-v21/strings.xml</em> e obtemos o seguinte:</p><pre name="9427" id="9427" class="graf graf--pre graf-after--p">strings.xml:            -v21/strings.xml:</pre><pre name="8006" id="8006" class="graf graf--pre graf-after--pre">string/app_name   0x00000001              NO_ENTRY</pre><pre name="d4f0" id="d4f0" class="graf graf--pre graf-after--pre">string/hello      0x00000002              NO_ENTRY</pre><pre name="34b3" id="34b3" class="graf graf--pre graf-after--pre">string/exit       0x00000003              NO_ENTRY</pre><pre name="1901" id="1901" class="graf graf--pre graf-after--pre">string/settings   0x00000004              NO_ENTRY</pre><pre name="3b73" id="3b73" class="graf graf--pre graf-after--pre">string/feature    0x00000005              0x00000006</pre><pre name="fb21" id="fb21" class="graf graf--pre graf-after--pre">                  ==========              ==========</pre><pre name="c7f6" id="c7f6" class="graf graf--pre graf-after--pre">Tamanho:          20 bytes                <strong class="markup--strong markup--pre-strong">20 bytes</strong>!</pre><p name="c69e" id="c69e" class="graf graf--p graf-after--pre">Está claramente visível que ambos arquivos ocupam 20 bytes mesmo que um deles tenha 4 “buracos” (memória reservada não utilizada).</p><p name="35ba" id="35ba" class="graf graf--p graf-after--p">Imagine uma aplicação que conta com 3500 strings, em que apenas uma foi traduzida em 50 idiomas. Isto resultará em:</p><p name="fac6" id="fac6" class="graf graf--p graf-after--p">4 bytes * 3500 buracos * 50 idiomas = 700kilobytes</p><p name="1306" id="1306" class="graf graf--p graf-after--p">700 kilobytes que podem ser salvos só por remover uma string.</p><p name="5d4f" id="5d4f" class="graf graf--p graf-after--p">Uma solução para esta situação seria ter 6 strings no ficheiro <em class="markup--em markup--p-em">values/strings.xml</em> e programar qual string deve ser usada dependendo da versão do Android.</p><p name="af67" id="af67" class="graf graf--p graf-after--p">Experimente estas dicas e diga, nos comentários, quanto espaço consegui reduzir na sua aplicação. Qualquer dúvida ou sugestão, mande um email para <a href="mailto:rosariofernandes51@gmail.com" data-href="mailto:rosariofernandes51@gmail.com" class="markup--anchor markup--p-anchor" target="_blank">rosariofernandes51@gmail.com</a></p><p name="9c66" id="9c66" class="graf graf--p graf-after--p">Até a próxima!</p><p name="f826" id="f826" class="graf graf--p graf-after--p graf--trailing">Rosário Pereira Fernandes</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@thatfire.dev" class="p-author h-card">Rosário Pereira Fernandes</a> on <a href="https://medium.com/p/1e398223161d"><time class="dt-published" datetime="2016-05-05T20:48:41.839Z">May 5, 2016</time></a>.</p><p><a href="https://medium.com/@thatfire.dev/smallerapk-5-dicas-para-reduzir-o-tamanho-do-apk-1e398223161d" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 24, 2025.</p></footer></article></body></html>